package bundle_test

import (
	. "github.com/iotaledger/iota.go/bundle"
	. "github.com/iotaledger/iota.go/consts"
	"github.com/iotaledger/iota.go/converter"
	"github.com/iotaledger/iota.go/transaction"
	. "github.com/iotaledger/iota.go/trinary"
	. "github.com/onsi/ginkgo"
	. "github.com/onsi/gomega"
	"strings"
	"time"
)

var _ = Describe("Bundle", func() {

	ts := uint64(time.Now().UnixNano() / int64(time.Millisecond))

	tag := "TAG" + strings.Repeat("9", 24)
	bndl := Bundle{
		{
			Address:                       strings.Repeat("A", 81),
			Value:                         -2,
			Tag:                           tag,
			ObsoleteTag:                   tag,
			CurrentIndex:                  0,
			LastIndex:                     2,
			Timestamp:                     1522219,
			SignatureMessageFragment:      NullSignatureMessageFragmentTrytes,
			TrunkTransaction:              NullHashTrytes,
			BranchTransaction:             NullHashTrytes,
			AttachmentTimestamp:           0,
			AttachmentTimestampLowerBound: 0,
			AttachmentTimestampUpperBound: 0,
			Bundle:                        NullHashTrytes,
			Nonce:                         NullNonceTrytes,
			Hash:                          NullHashTrytes,
		},

		{
			Address:                       strings.Repeat("A", 81),
			Value:                         0,
			Tag:                           tag,
			ObsoleteTag:                   tag,
			CurrentIndex:                  1,
			LastIndex:                     2,
			Timestamp:                     1522219,
			SignatureMessageFragment:      NullSignatureMessageFragmentTrytes,
			TrunkTransaction:              NullHashTrytes,
			BranchTransaction:             NullHashTrytes,
			AttachmentTimestamp:           0,
			AttachmentTimestampLowerBound: 0,
			AttachmentTimestampUpperBound: 0,
			Bundle:                        NullHashTrytes,
			Nonce:                         NullNonceTrytes,
			Hash:                          NullHashTrytes,
		},

		{
			Address:                       strings.Repeat("B", 81),
			Value:                         2,
			Tag:                           tag,
			ObsoleteTag:                   tag,
			CurrentIndex:                  2,
			LastIndex:                     2,
			Timestamp:                     1522219,
			SignatureMessageFragment:      NullSignatureMessageFragmentTrytes,
			TrunkTransaction:              NullHashTrytes,
			BranchTransaction:             NullHashTrytes,
			AttachmentTimestamp:           0,
			AttachmentTimestampLowerBound: 0,
			AttachmentTimestampUpperBound: 0,
			Bundle:                        NullHashTrytes,
			Nonce:                         NullNonceTrytes,
			Hash:                          NullHashTrytes,
		},
	}

	Context("TransfersToBundleEntries()", func() {
		It("converts single transfer to correct entry", func() {
			msg, err := converter.ASCIIToTrytes("test")
			Expect(err).ToNot(HaveOccurred())
			transfers := Transfers{
				{
					Address: "CXKGVXEIOPZ9GNZSOK9FNAOUJGZJTMLUNOZXQFUORDFPVQANZGYJUYWPHVGMO9JULGFZYHAAXEIJGCBIDFTFKBCWCD",
					Message: msg,
					Tag:     "BALALAIKA",
					Value:   50,
				},
			}

			entries, err := TransfersToBundleEntries(ts, transfers...)
			Expect(err).ToNot(HaveOccurred())

			Expect(len(entries)).To(Equal(1))
			entry := entries[0]
			Expect(entry.Address).To(Equal(transfers[0].Address[:81]))
			Expect(len(entry.SignatureMessageFragments)).To(Equal(1))
			Expect(entry.SignatureMessageFragments[0]).To(Equal(Pad(msg, SignatureMessageFragmentSizeInTrytes)))
			Expect(entry.Value).To(Equal(int64(transfers[0].Value)))
		})

		It("converts single transfer with large message to correct entry", func() {
			txsToFitMsg := 3
			msg := strings.Repeat("A", SignatureMessageFragmentSizeInTrytes*txsToFitMsg)
			transfers := Transfers{
				{
					Address: "CXKGVXEIOPZ9GNZSOK9FNAOUJGZJTMLUNOZXQFUORDFPVQANZGYJUYWPHVGMO9JULGFZYHAAXEIJGCBIDFTFKBCWCD",
					Message: msg,
					Tag:     "BALALAIKA",
					Value:   50,
				},
			}

			entries, err := TransfersToBundleEntries(ts, transfers...)
			Expect(err).ToNot(HaveOccurred())

			Expect(len(entries)).To(Equal(1))
			entry := entries[0]
			Expect(entry.Address).To(Equal(transfers[0].Address[:81]))
			Expect(len(entry.SignatureMessageFragments)).To(Equal(txsToFitMsg))
			Expect(entry.SignatureMessageFragments[0]).To(Equal(strings.Repeat("A", SignatureMessageFragmentSizeInTrytes)))
			Expect(entry.Value).To(Equal(int64(transfers[0].Value)))
		})

		It("returns an error if non address is given in a transfer", func() {
			transfers := Transfers{
				{
					Address: "BALALAIKA",
					Message: "BALALAIKA",
					Tag:     "BALALAIKA",
					Value:   50,
				},
			}

			_, err := TransfersToBundleEntries(ts, transfers...)
			Expect(err).To(HaveOccurred())
		})
	})

	Context("AddEntry()", func() {

		It("adds a single transaction for an entry with length 1", func() {
			bndl := Bundle{}
			bndl = AddEntry(bndl, BundleEntry{
				Value:                     50,
				SignatureMessageFragments: []Trytes{strings.Repeat("9", SignatureMessageFragmentSizeInTrytes)},
				Address:                   "OJOOKRYUHHQSSIMSPVJNWORFIGHPBKTDWKIVDFRGNWLTDKGQUWEBGLMYJCLDFG9VORVWQGXXK9FNBTURB",
				Tag:                       PadTag("TEST"),
				Timestamp:                 ts,
				Length:                    1,
			})

			Expect(len(bndl)).To(Equal(1))
			tx := bndl[0]
			Expect(tx.CurrentIndex).To(Equal(uint64(0)))
			Expect(tx.LastIndex).To(Equal(uint64(0)))
			Expect(tx.Value).To(Equal(int64(50)))
			Expect(tx.Tag).To(Equal(PadTag("TEST")))
			Expect(tx.SignatureMessageFragment).To(Equal(strings.Repeat("9", SignatureMessageFragmentSizeInTrytes)))
		})

		It("adds multiple transactions for an entry with length 3", func() {
			bndl := Bundle{}
			bndl = AddEntry(bndl, BundleEntry{
				Value: 50,
				SignatureMessageFragments: []Trytes{
					strings.Repeat("9", SignatureMessageFragmentSizeInTrytes),
					strings.Repeat("9", SignatureMessageFragmentSizeInTrytes),
					strings.Repeat("9", SignatureMessageFragmentSizeInTrytes),
				},
				Address:   "OJOOKRYUHHQSSIMSPVJNWORFIGHPBKTDWKIVDFRGNWLTDKGQUWEBGLMYJCLDFG9VORVWQGXXK9FNBTURB",
				Tag:       PadTag("TEST"),
				Timestamp: ts,
				Length:    3,
			})

			Expect(len(bndl)).To(Equal(3))
			tx := bndl[0]
			Expect(bndl[0].CurrentIndex).To(Equal(uint64(0)))
			Expect(bndl[1].CurrentIndex).To(Equal(uint64(1)))
			Expect(bndl[2].CurrentIndex).To(Equal(uint64(2)))
			Expect(tx.LastIndex).To(Equal(uint64(2)))
			Expect(tx.Value).To(Equal(int64(50)))
			Expect(tx.Tag).To(Equal(PadTag("TEST")))
			Expect(tx.SignatureMessageFragment).To(Equal(strings.Repeat("9", SignatureMessageFragmentSizeInTrytes)))
		})
	})

	Context("Finalize()", func() {

		It("computes the bundle hash and adds it to all transactions in the bundle", func() {
			bndlCopy := make(Bundle, len(bndl))
			copy(bndlCopy, bndl)
			_, err := Finalize(bndlCopy)
			Expect(err).ToNot(HaveOccurred())
			Expect(bndlCopy[0].Bundle).To(Equal("VRGXKZDODWIVGFYFCCXJRNDCQJVYUVBRIWJXKFGBIEWUPHHTJLTKH99JW9OLJ9JCIXCEIRRXJKLWOBDZZ"))
		})
	})

	Context("AddTrytes()", func() {
		It("adds the given trytes correctly to the transactions", func() {
			bndlCopy := make(Bundle, len(bndl))
			copy(bndlCopy, bndl)
			bndlCopy = AddTrytes(bndlCopy, []Trytes{"TRYTES", "TRYTES", "TRYTES"}, 0)
			Expect(bndlCopy[0].SignatureMessageFragment).To(Equal("TRYTES" + strings.Repeat("9", SignatureMessageFragmentSizeInTrytes-6)))
			Expect(bndlCopy[1].SignatureMessageFragment).To(Equal("TRYTES" + strings.Repeat("9", SignatureMessageFragmentSizeInTrytes-6)))
			Expect(bndlCopy[2].SignatureMessageFragment).To(Equal("TRYTES" + strings.Repeat("9", SignatureMessageFragmentSizeInTrytes-6)))
		})
	})

	Context("ValidateBundleSignatures()", func() {
		It("returns true for a valid signatures", func() {
			bndl, err := transaction.AsTransactionObjects([]Trytes{
				"ADXCBDTCXCCDHDPCSARCCDAD999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SYW9TZUZIRLR9SKTGTINGHZMJQXIQNVDT9NNEBHMBI9IGEQFUZSULZYZVAMRGCOOMIDFJKTF9TKFMJTPDEZKD99999999999999999999999AUOEIOTADOTCOM9999999999999AHGWHZD99999999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWXRTQTHZSSPBKNZUPPZCHBQXZHDXPJHFBVYDYXRJBP9PT9J9CDDILDLFCAVMEOQ9PDVXFASAUVDYB9Z9999LGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999MINEIOTADOTCOM9999999999999ZA9METELE999999999MMMMMMMMM9BNPYHCWUMDDVKNDUWX9KN9O9ZP",
				"PLPAOU9KJGDRECJOYVOGPMAUTOVSSIS9REDBVBRQTADVPISW9MJBLGXHUNOWCDSITOUPXUMWNXFBIVAZDMNQHSFFUFSIJGEDRWUWMWNRXFPKWPOWLPYBMSYRNBAJWATLWHQBRNZWPOVXXITRCKWLKWTYGHX9UQ9TIBWYBRWXCTGNYCJYBAEXGTQPZFNE9PGX9IMQXWYHSGFZYTIBENNRUGAOXXQZZNLXKIVGUYYUELMQHNEYCYBPJGQVXBHWYOMQBORISBFBRZLJFJMVLXXDSQBPRGYUXUW9HMCLHD9YYYBSY9MIDMJHXGVQRUUU9LNNMGBBRHBZDMOMAAQRAPNJOEVCXZZMGUBSB9O9MLQSUYNCWKBSJYXQPIRIJIYDWGHWUMAXIWB99YM9GZJQOYOYABAEBHINQVPRXFKEJRMDBGVVWMQWQNHRWFHCKDFGGQMIOTMMBCVRYEEEDZJSMCWDSFFB9QUMMTBIRR9KUBZVYSFGIHWHGLVXZNHYBWVEBERTJRREJUHTITCDNDPWQKFYTBCXKRNS99SFHCQNUUL9SMMVS9YBFQ9UQHYBAPCWHULJRMHFKBWSKWOUUVNVWQOIBVZZUPYGEEWGRDVSSCWXZDYMZN9VLJNFNCYIQSKMDHLGAKTAEUPXPCUYZ9AMGFZMSBDPUNNUVP9P9QTMFUGINRNJCJYJKBS9P9NLDAPCEATATOGMRCGJSAAALLGZNOWDFYOPWMAQMFTKPUSLTZKKJTAJLRAVRP9EXRZGMKIKZPBJWYPUEWIIYXSEH9HBCCUBFWGOURNYLENBEB9QHTIIJXDJ9QHIUITLAJCIQGJXIXOGMCWRGBIISXTDWQJCBFKQIX9RJMQZGXKZBMKFXHXGBLXAGLDZRIGGTETCDGWPQIZOEXATGCHEMAITZRPIKDYTJJJVBAJIDNGLIVPS9CMAYRHVYEULFVFIGLXHNO9NJCUKZ9TGLQUJQKNWDVUSBKCSHQFTRQCYEKT9ULRJMAOC9HTL9ZRUHIOTGHPYNLAZEVLEDESXWHZOL9DKWPZBOWIUKHV9IIOTDXHELGGMMVAAYOITSLVCWBKWFGRUJFIXYRTELSMFCZGKMAPOYGQLGBQXDPGGHLYBQPVNJUDBOLGLRBALAXELHFIIZAZLXMAE9VVCBBEQNMSIOEUWIBTQWSSZBB9LDGZLSJKEDLMJUDRDTAWGPBYVNJ9XBR9YWRHSXCAKUMWYPFUXX9ANVPIRIRWDYGCKTYRTBNFQUHVVJFSFPNGPTFX9FDYFMTADCTKGZEHGUEPKPCCYIFOMXXGCQJBQXESRYCOOEZPFM9HPDA9XJBB9EZCPUKILAIXEFMEG9PTNVRVIZMXFYFYPBHEANRS9XQZOZKTSXUNIZPPZDRRO9LRUTMWSBDPHDYJA9JQREHZWVZCDDFEEJXODGSYQGZEYEZXAJJDKHDFTCYBE9HADWEJBYDITEDMVXSHC9ZHMMKXLA9TGZN99KMCLZWBMUA9MSDGASTM9RDQPFFHCGPKVXHTGVJ9GATVONTGOYUGLQVKZLOWMSAEQFIMJYAKSYA9YKVTJOJOSINAOXV9MAQUGOURKZDXSKEMATUBGGKDRIGX99XHUICRVVDTYWRJYDMNBJIQDJVQLXHBDVWAKYPGJONCBUICUFQTWVXX9VJNYUKAHASQSEHCDKIHLNZKFMDQURWVDYLKJHVQTCDRMCZEPNKPBMSINNWEQFOGBLIZFGSVNJAACKYIXMQXPMEDOPCNUXPKRP9TMYWXDLOPJQTFHPSRQTRRMF9QEOZDD9JCBKGORANZEBESVPKTGCRCIGGSLMFLEZGJXFLQCJHDQKY9OH9DFF9AXZQWEPVRIOH9PAWBFZLXFKPZDODYROUDYJRMEWMBVZWXJWXYMYEIQDZZKXWXDYVHMXPMBJ9QSOJIZIZYUDZCBAPKXDWNU9FSWIKTMNQCWGJYDE9R9OZSFD9HEUKTJKXQFUSEJMQVUMNNYTWNTHNPODHFGEDBWQLSPZBQKGSIQVNOCXTHJWFQEZSLBXARGIISLFYZYHNKEVGHXNMZQWKYPNHRH9FUQCZH9CSWPITQRKQGNNFZTCHN9JNNZ9MZENMHBSNIXWAAADD9WKAFEHWKEWJUSFOFJMBULIIYPLIREJROPYASNXHXSLQXWTFVNNWIUHVLDXXTMNAGHBVWAEINAQTOO9FWQMGIAF9PZFYGEMRCXITWQWHVOISHXUHRSJJUVKYKJLZNMUWWGVQESIQTJXZKEITBRGNTYKULBFODPUMWXKMEQLZ999999999999999999999MINEIOTADOTCOM9999999999999AHGWHZD99A99999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWXHBBNAAY9GHWJCGKCEFUEVOBSOWZGPUILKRGGPEQ9BLVFRPBEMXYMIYPSTJHKG9QIBAYVVVSAALQD99999LGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999MINEIOTADOTCOM9999999999999MQZMETELE999999999MMMMMMMMMJYIPWHUOFJYBPNOHGZTVAKWBUVU",
				"KBFYZAUCZGPDNUYDURLDJHJ9ZISABKTXOTKHDUNFNZCKSHEEADONVIEBUMFSICJOETVCJQZLTMMQA9ERBHBWEHNHW9PCXNBZOKVCBMCWTPVUTTHN9PQDFTUSFOZTCDK9PSXFBEQWDEQZJIKGCIJUWLUIDQXHL9IIPXTQP9WS9VIRQAORMKVSDNFBVVKRXCCAQMLUALBJTIPKPNPJHQSRXKLKCXXLC9MBPFSMKPNJQAFOJMQBJKDKQJ9YOJWELOOQHOQNOGHPMBUHONFZIIXUOVZOQXM9KRPXHZXNPFXMSYNVFEFOMICFW9TFOUQNUP9DCO9WCBZUGVAFMHNNSNCJVQKMIFL9MRESEUNQEJUKSAVHFB9KIZCQOYSHEZFBD9JJACF9BXUE9ODOESNBRATQXMTSCJSGUIWHJWMINFXIIYAH9BDWNROMRFZGHZYTBPQEORKD9WCOOPKNXIBRZAKMLJAMIMDZWLWLQKEFIZXAQROTAEFVWSCRKPSQPLXJVAJ9IFMHUGOOQUOARFHXAZROEFKIKSWLGFNXSOINFNTB9HBZDDZNYFVBD9DJQECNQBQZBVEEHDEOZCRKIFJBFXJTXGBZXPHPATJPEXTE9QORJEQHNHEUAWCZCWGFCLQTIWWJOJOPLQUWDAGNFMPNSE9RVJNMPTXZHECSHYJHTA9WGYHWIZNPPYEPMTFMRZN9TBNANM9LUSWINYCMGMS9HSN9E9BKC9RKOCWTBTAYTZRUNBQMGKBIRD9TVDVYRDJPCITZGTRQQWBQJCOUWZEQXGWBESBBQHPEEBMXBXSXYNRYAWZUNYLSQDUNHDIGKCQSPLJHWPIMAJOQLLXUCTQORTSHFDUTZREPHCJASH9YZUGGFJLRTQFVMBWVWPCNQMC9JBMQCFBAXDAUPZLVKCGDUHFXHBGVCIRLJBTFCKFG9KFTBSNNKOROSRCNBKGHFZJLYOREG9XQRNDZHTZDWSRFZNRHODIUHVNNAPQJSNJEVIZPPZDKGYPYFBIZGTPVEWBR9BCOFIXGCFPJGHNNAXQEYFNQELGXZXKZAVBFDLHYUIGZKJLYCCVNCISQYMGXMSTJWMLBM9LBSJOMZPZQYABLRDKGVNIYRJVFUQCKDAORTXSAQDBDZAL9EBVZHQTZ9FIVO9KUTMVDWNOTIPJQUEYRGREXDYRVHKZ9N9PMVRWCDEULUODQZPDYTMKBRBPAEOGO9MDRIAKSCCEIGXIDLJTVW9SIUKMOYLPVWEOKBHCQGJEFQNTHYWXKBVDRWSPZBSSOAHMSPHLNRRHSNQMNQA9DAJKCESOLIKKCKIAWTFVSOWXOEKZTUOCJFHRBZWM9SDXZTWOZDTJRKLNAZXCCZMKOPYXJPQDSWW9YQRVTXNUT9RSWDGMRODRKMMHCTVCFYIULJPTRWJNGMKFLCMXKTABSJNBJBMEATJRPZJDDNAEIHJVVKCBOLQSMNXJ9QEDCRKWOYOFHUOYBVN9KNVTNDDAPIVMIYBBJSPQ9BAXSWFQ9QCSF9HHORXVASKPSIWRYD9SETSKCYT9QYRA9ENHBHIBFAROCVJAEKAVBPSWFUAEBDWZXLFXQRJJBUYDRFQLMLNVDHJHRFEGLOTYGESAOXEPCVAT9YSAJSGJGNCIK9CFGYHMHCFWHTBNAOV9OFNPC9TGWJJTOBEADHUDYQNDNYYKQAPJ9JKEBVZQLFUISAGEXWYSLNXPHVBYAAY9EXJJOJNDZMHYLGDKHOBPOBHHYQKRRALBMDEJWKJBPAB9JSUEDKRPQFJLD9ICSDSZGKZEVKLEBTCICITYITPLFGQ9JTJQPZEYPOMNNEYHQZRBJRNBWUKWVP9LPERBXWCSOXBGUWVJPYNFAWJ9IJQXOBVLGIHWDDQ9PJYF9AONOOTFECITZKPSNTJLGPISULEXGRSBDDTVTQCUDUEWMJ9KT9TJHMQFLTFQDFMECIPY9WOXVQHUVVMJAXOHPJKTAVJSVBTCKOKLZFRTVUEZRGPFISRMRSHLZQBFFMENXDMQL9DQBWOJFNK9UDFZAMVFNOGGYJOKVTXQFHXJCGPVX9FHYZJYBOSIHGZHFPMKWRHSS9HZGTRNFDJXIZOHQKLXIEHJKJSKYJCVLLOQJBWAWTMPGCCUBUDAEUVJQTDASTKVLPIDLGFAABZTVCWEUQACASZFKI9ACCYKHECKFOKM9NRD9UACQMGIAF9PZFYGEMRCXITWQWHVOISHXUHRSJJUVKYKJLZNMUWWGVQESIQTJXZKEITBRGNTYKULBFODPUMWX999999999999999999999999999MINEIOTADOTCOM9999999999999AHGWHZD99B99999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWX9TGCJUR9WCKWVPDQXEWYCXIL9TSLYCRBCSISCOFRSXRWYEOOTNULLUJQXQEQMGEXK9KFUORYOGHCZ9999LGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999MINEIOTADOTCOM9999999999999PKXMETELE999999999MMMMMMMMMXRBQBGMXPMBQMLPOYTSOQVQDVNA",
				"999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999WHOEHZVGLRPYPQATCPAULHGWLT9VQPPCRYXQPAHZOTFRMFVXEUGUZA9QPRKZNMGUHMWLXYLSR9RCILQRCKNKEOA999999999999999999999MINEIOTADOTCOM9999999999999AHGWHZD99C99999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWXLGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999EQHDYUJCZGMVMZYLX9GNZQCDAQYHICVELAVJWUGH9NZJCMNGPVZOJCGLENQX9EYKKUJRGZKXYLZN99999MINEIOTADOTCOM9999999999999FCXMETELE999999999MMMMMMMMMSUSGEIWOHIJSVSOWDWYAWJWGPEN",
			}, nil)
			Expect(err).ToNot(HaveOccurred())
			valid, err := ValidateBundleSignatures(bndl)
			Expect(err).ToNot(HaveOccurred())
			Expect(valid).To(BeTrue())
		})

		It("returns false for a valid signatures", func() {
			bndl, err := transaction.AsTransactionObjects([]Trytes{
				"ADXCBDTCXCCDHDPCSARCCDAD999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SYW9TZUZIRLR9SKTGTINGHZMJQXIQNVDT9NNEBHMBI9IGEQFUZSULZYZVAMRGCOOMIDFJKTF9TKFMJTPDEZKD99999999999999999999999AUOEIOTADOTCOM9999999999999AHGWHZD99999999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWXRTQTHZSSPBKNZUPPZCHBQXZHDXPJHFBVYDYXRJBP9PT9J9CDDILDLFCAVMEOQ9PDVXFASAUVDYB9Z9999LGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999MINEIOTADOTCOM9999999999999ZA9METELE999999999MMMMMMMMM9BNPYHCWUMDDVKNDUWX9KN9O9ZP",
				// modified
				"BLABLABKJGDRECJOYVOGPMAUTOVSSIS9REDBVBRQTADVPISW9MJBLGXHUNOWCDSITOUPXUMWNXFBIVAZDMNQHSFFUFSIJGEDRWUWMWNRXFPKWPOWLPYBMSYRNBAJWATLWHQBRNZWPOVXXITRCKWLKWTYGHX9UQ9TIBWYBRWXCTGNYCJYBAEXGTQPZFNE9PGX9IMQXWYHSGFZYTIBENNRUGAOXXQZZNLXKIVGUYYUELMQHNEYCYBPJGQVXBHWYOMQBORISBFBRZLJFJMVLXXDSQBPRGYUXUW9HMCLHD9YYYBSY9MIDMJHXGVQRUUU9LNNMGBBRHBZDMOMAAQRAPNJOEVCXZZMGUBSB9O9MLQSUYNCWKBSJYXQPIRIJIYDWGHWUMAXIWB99YM9GZJQOYOYABAEBHINQVPRXFKEJRMDBGVVWMQWQNHRWFHCKDFGGQMIOTMMBCVRYEEEDZJSMCWDSFFB9QUMMTBIRR9KUBZVYSFGIHWHGLVXZNHYBWVEBERTJRREJUHTITCDNDPWQKFYTBCXKRNS99SFHCQNUUL9SMMVS9YBFQ9UQHYBAPCWHULJRMHFKBWSKWOUUVNVWQOIBVZZUPYGEEWGRDVSSCWXZDYMZN9VLJNFNCYIQSKMDHLGAKTAEUPXPCUYZ9AMGFZMSBDPUNNUVP9P9QTMFUGINRNJCJYJKBS9P9NLDAPCEATATOGMRCGJSAAALLGZNOWDFYOPWMAQMFTKPUSLTZKKJTAJLRAVRP9EXRZGMKIKZPBJWYPUEWIIYXSEH9HBCCUBFWGOURNYLENBEB9QHTIIJXDJ9QHIUITLAJCIQGJXIXOGMCWRGBIISXTDWQJCBFKQIX9RJMQZGXKZBMKFXHXGBLXAGLDZRIGGTETCDGWPQIZOEXATGCHEMAITZRPIKDYTJJJVBAJIDNGLIVPS9CMAYRHVYEULFVFIGLXHNO9NJCUKZ9TGLQUJQKNWDVUSBKCSHQFTRQCYEKT9ULRJMAOC9HTL9ZRUHIOTGHPYNLAZEVLEDESXWHZOL9DKWPZBOWIUKHV9IIOTDXHELGGMMVAAYOITSLVCWBKWFGRUJFIXYRTELSMFCZGKMAPOYGQLGBQXDPGGHLYBQPVNJUDBOLGLRBALAXELHFIIZAZLXMAE9VVCBBEQNMSIOEUWIBTQWSSZBB9LDGZLSJKEDLMJUDRDTAWGPBYVNJ9XBR9YWRHSXCAKUMWYPFUXX9ANVPIRIRWDYGCKTYRTBNFQUHVVJFSFPNGPTFX9FDYFMTADCTKGZEHGUEPKPCCYIFOMXXGCQJBQXESRYCOOEZPFM9HPDA9XJBB9EZCPUKILAIXEFMEG9PTNVRVIZMXFYFYPBHEANRS9XQZOZKTSXUNIZPPZDRRO9LRUTMWSBDPHDYJA9JQREHZWVZCDDFEEJXODGSYQGZEYEZXAJJDKHDFTCYBE9HADWEJBYDITEDMVXSHC9ZHMMKXLA9TGZN99KMCLZWBMUA9MSDGASTM9RDQPFFHCGPKVXHTGVJ9GATVONTGOYUGLQVKZLOWMSAEQFIMJYAKSYA9YKVTJOJOSINAOXV9MAQUGOURKZDXSKEMATUBGGKDRIGX99XHUICRVVDTYWRJYDMNBJIQDJVQLXHBDVWAKYPGJONCBUICUFQTWVXX9VJNYUKAHASQSEHCDKIHLNZKFMDQURWVDYLKJHVQTCDRMCZEPNKPBMSINNWEQFOGBLIZFGSVNJAACKYIXMQXPMEDOPCNUXPKRP9TMYWXDLOPJQTFHPSRQTRRMF9QEOZDD9JCBKGORANZEBESVPKTGCRCIGGSLMFLEZGJXFLQCJHDQKY9OH9DFF9AXZQWEPVRIOH9PAWBFZLXFKPZDODYROUDYJRMEWMBVZWXJWXYMYEIQDZZKXWXDYVHMXPMBJ9QSOJIZIZYUDZCBAPKXDWNU9FSWIKTMNQCWGJYDE9R9OZSFD9HEUKTJKXQFUSEJMQVUMNNYTWNTHNPODHFGEDBWQLSPZBQKGSIQVNOCXTHJWFQEZSLBXARGIISLFYZYHNKEVGHXNMZQWKYPNHRH9FUQCZH9CSWPITQRKQGNNFZTCHN9JNNZ9MZENMHBSNIXWAAADD9WKAFEHWKEWJUSFOFJMBULIIYPLIREJROPYASNXHXSLQXWTFVNNWIUHVLDXXTMNAGHBVWAEINAQTOO9FWQMGIAF9PZFYGEMRCXITWQWHVOISHXUHRSJJUVKYKJLZNMUWWGVQESIQTJXZKEITBRGNTYKULBFODPUMWXKMEQLZ999999999999999999999MINEIOTADOTCOM9999999999999AHGWHZD99A99999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWXHBBNAAY9GHWJCGKCEFUEVOBSOWZGPUILKRGGPEQ9BLVFRPBEMXYMIYPSTJHKG9QIBAYVVVSAALQD99999LGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999MINEIOTADOTCOM9999999999999MQZMETELE999999999MMMMMMMMMJYIPWHUOFJYBPNOHGZTVAKWBUVU",
				"KBFYZAUCZGPDNUYDURLDJHJ9ZISABKTXOTKHDUNFNZCKSHEEADONVIEBUMFSICJOETVCJQZLTMMQA9ERBHBWEHNHW9PCXNBZOKVCBMCWTPVUTTHN9PQDFTUSFOZTCDK9PSXFBEQWDEQZJIKGCIJUWLUIDQXHL9IIPXTQP9WS9VIRQAORMKVSDNFBVVKRXCCAQMLUALBJTIPKPNPJHQSRXKLKCXXLC9MBPFSMKPNJQAFOJMQBJKDKQJ9YOJWELOOQHOQNOGHPMBUHONFZIIXUOVZOQXM9KRPXHZXNPFXMSYNVFEFOMICFW9TFOUQNUP9DCO9WCBZUGVAFMHNNSNCJVQKMIFL9MRESEUNQEJUKSAVHFB9KIZCQOYSHEZFBD9JJACF9BXUE9ODOESNBRATQXMTSCJSGUIWHJWMINFXIIYAH9BDWNROMRFZGHZYTBPQEORKD9WCOOPKNXIBRZAKMLJAMIMDZWLWLQKEFIZXAQROTAEFVWSCRKPSQPLXJVAJ9IFMHUGOOQUOARFHXAZROEFKIKSWLGFNXSOINFNTB9HBZDDZNYFVBD9DJQECNQBQZBVEEHDEOZCRKIFJBFXJTXGBZXPHPATJPEXTE9QORJEQHNHEUAWCZCWGFCLQTIWWJOJOPLQUWDAGNFMPNSE9RVJNMPTXZHECSHYJHTA9WGYHWIZNPPYEPMTFMRZN9TBNANM9LUSWINYCMGMS9HSN9E9BKC9RKOCWTBTAYTZRUNBQMGKBIRD9TVDVYRDJPCITZGTRQQWBQJCOUWZEQXGWBESBBQHPEEBMXBXSXYNRYAWZUNYLSQDUNHDIGKCQSPLJHWPIMAJOQLLXUCTQORTSHFDUTZREPHCJASH9YZUGGFJLRTQFVMBWVWPCNQMC9JBMQCFBAXDAUPZLVKCGDUHFXHBGVCIRLJBTFCKFG9KFTBSNNKOROSRCNBKGHFZJLYOREG9XQRNDZHTZDWSRFZNRHODIUHVNNAPQJSNJEVIZPPZDKGYPYFBIZGTPVEWBR9BCOFIXGCFPJGHNNAXQEYFNQELGXZXKZAVBFDLHYUIGZKJLYCCVNCISQYMGXMSTJWMLBM9LBSJOMZPZQYABLRDKGVNIYRJVFUQCKDAORTXSAQDBDZAL9EBVZHQTZ9FIVO9KUTMVDWNOTIPJQUEYRGREXDYRVHKZ9N9PMVRWCDEULUODQZPDYTMKBRBPAEOGO9MDRIAKSCCEIGXIDLJTVW9SIUKMOYLPVWEOKBHCQGJEFQNTHYWXKBVDRWSPZBSSOAHMSPHLNRRHSNQMNQA9DAJKCESOLIKKCKIAWTFVSOWXOEKZTUOCJFHRBZWM9SDXZTWOZDTJRKLNAZXCCZMKOPYXJPQDSWW9YQRVTXNUT9RSWDGMRODRKMMHCTVCFYIULJPTRWJNGMKFLCMXKTABSJNBJBMEATJRPZJDDNAEIHJVVKCBOLQSMNXJ9QEDCRKWOYOFHUOYBVN9KNVTNDDAPIVMIYBBJSPQ9BAXSWFQ9QCSF9HHORXVASKPSIWRYD9SETSKCYT9QYRA9ENHBHIBFAROCVJAEKAVBPSWFUAEBDWZXLFXQRJJBUYDRFQLMLNVDHJHRFEGLOTYGESAOXEPCVAT9YSAJSGJGNCIK9CFGYHMHCFWHTBNAOV9OFNPC9TGWJJTOBEADHUDYQNDNYYKQAPJ9JKEBVZQLFUISAGEXWYSLNXPHVBYAAY9EXJJOJNDZMHYLGDKHOBPOBHHYQKRRALBMDEJWKJBPAB9JSUEDKRPQFJLD9ICSDSZGKZEVKLEBTCICITYITPLFGQ9JTJQPZEYPOMNNEYHQZRBJRNBWUKWVP9LPERBXWCSOXBGUWVJPYNFAWJ9IJQXOBVLGIHWDDQ9PJYF9AONOOTFECITZKPSNTJLGPISULEXGRSBDDTVTQCUDUEWMJ9KT9TJHMQFLTFQDFMECIPY9WOXVQHUVVMJAXOHPJKTAVJSVBTCKOKLZFRTVUEZRGPFISRMRSHLZQBFFMENXDMQL9DQBWOJFNK9UDFZAMVFNOGGYJOKVTXQFHXJCGPVX9FHYZJYBOSIHGZHFPMKWRHSS9HZGTRNFDJXIZOHQKLXIEHJKJSKYJCVLLOQJBWAWTMPGCCUBUDAEUVJQTDASTKVLPIDLGFAABZTVCWEUQACASZFKI9ACCYKHECKFOKM9NRD9UACQMGIAF9PZFYGEMRCXITWQWHVOISHXUHRSJJUVKYKJLZNMUWWGVQESIQTJXZKEITBRGNTYKULBFODPUMWX999999999999999999999999999MINEIOTADOTCOM9999999999999AHGWHZD99B99999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWX9TGCJUR9WCKWVPDQXEWYCXIL9TSLYCRBCSISCOFRSXRWYEOOTNULLUJQXQEQMGEXK9KFUORYOGHCZ9999LGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999MINEIOTADOTCOM9999999999999PKXMETELE999999999MMMMMMMMMXRBQBGMXPMBQMLPOYTSOQVQDVNA",
				"999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999WHOEHZVGLRPYPQATCPAULHGWLT9VQPPCRYXQPAHZOTFRMFVXEUGUZA9QPRKZNMGUHMWLXYLSR9RCILQRCKNKEOA999999999999999999999MINEIOTADOTCOM9999999999999AHGWHZD99C99999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWXLGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999EQHDYUJCZGMVMZYLX9GNZQCDAQYHICVELAVJWUGH9NZJCMNGPVZOJCGLENQX9EYKKUJRGZKXYLZN99999MINEIOTADOTCOM9999999999999FCXMETELE999999999MMMMMMMMMSUSGEIWOHIJSVSOWDWYAWJWGPEN",
			}, nil)
			Expect(err).ToNot(HaveOccurred())
			valid, err := ValidateBundleSignatures(bndl)
			Expect(err).ToNot(HaveOccurred())
			Expect(valid).To(BeFalse())
		})
	})

	Context("ValidBundle()", func() {
		It("returns true for a valid bundle", func() {
			bndl, err := transaction.AsTransactionObjects([]Trytes{
				"ADXCBDTCXCCDHDPCSARCCDAD999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SYW9TZUZIRLR9SKTGTINGHZMJQXIQNVDT9NNEBHMBI9IGEQFUZSULZYZVAMRGCOOMIDFJKTF9TKFMJTPDEZKD99999999999999999999999AUOEIOTADOTCOM9999999999999AHGWHZD99999999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWXRTQTHZSSPBKNZUPPZCHBQXZHDXPJHFBVYDYXRJBP9PT9J9CDDILDLFCAVMEOQ9PDVXFASAUVDYB9Z9999LGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999MINEIOTADOTCOM9999999999999ZA9METELE999999999MMMMMMMMM9BNPYHCWUMDDVKNDUWX9KN9O9ZP",
				"PLPAOU9KJGDRECJOYVOGPMAUTOVSSIS9REDBVBRQTADVPISW9MJBLGXHUNOWCDSITOUPXUMWNXFBIVAZDMNQHSFFUFSIJGEDRWUWMWNRXFPKWPOWLPYBMSYRNBAJWATLWHQBRNZWPOVXXITRCKWLKWTYGHX9UQ9TIBWYBRWXCTGNYCJYBAEXGTQPZFNE9PGX9IMQXWYHSGFZYTIBENNRUGAOXXQZZNLXKIVGUYYUELMQHNEYCYBPJGQVXBHWYOMQBORISBFBRZLJFJMVLXXDSQBPRGYUXUW9HMCLHD9YYYBSY9MIDMJHXGVQRUUU9LNNMGBBRHBZDMOMAAQRAPNJOEVCXZZMGUBSB9O9MLQSUYNCWKBSJYXQPIRIJIYDWGHWUMAXIWB99YM9GZJQOYOYABAEBHINQVPRXFKEJRMDBGVVWMQWQNHRWFHCKDFGGQMIOTMMBCVRYEEEDZJSMCWDSFFB9QUMMTBIRR9KUBZVYSFGIHWHGLVXZNHYBWVEBERTJRREJUHTITCDNDPWQKFYTBCXKRNS99SFHCQNUUL9SMMVS9YBFQ9UQHYBAPCWHULJRMHFKBWSKWOUUVNVWQOIBVZZUPYGEEWGRDVSSCWXZDYMZN9VLJNFNCYIQSKMDHLGAKTAEUPXPCUYZ9AMGFZMSBDPUNNUVP9P9QTMFUGINRNJCJYJKBS9P9NLDAPCEATATOGMRCGJSAAALLGZNOWDFYOPWMAQMFTKPUSLTZKKJTAJLRAVRP9EXRZGMKIKZPBJWYPUEWIIYXSEH9HBCCUBFWGOURNYLENBEB9QHTIIJXDJ9QHIUITLAJCIQGJXIXOGMCWRGBIISXTDWQJCBFKQIX9RJMQZGXKZBMKFXHXGBLXAGLDZRIGGTETCDGWPQIZOEXATGCHEMAITZRPIKDYTJJJVBAJIDNGLIVPS9CMAYRHVYEULFVFIGLXHNO9NJCUKZ9TGLQUJQKNWDVUSBKCSHQFTRQCYEKT9ULRJMAOC9HTL9ZRUHIOTGHPYNLAZEVLEDESXWHZOL9DKWPZBOWIUKHV9IIOTDXHELGGMMVAAYOITSLVCWBKWFGRUJFIXYRTELSMFCZGKMAPOYGQLGBQXDPGGHLYBQPVNJUDBOLGLRBALAXELHFIIZAZLXMAE9VVCBBEQNMSIOEUWIBTQWSSZBB9LDGZLSJKEDLMJUDRDTAWGPBYVNJ9XBR9YWRHSXCAKUMWYPFUXX9ANVPIRIRWDYGCKTYRTBNFQUHVVJFSFPNGPTFX9FDYFMTADCTKGZEHGUEPKPCCYIFOMXXGCQJBQXESRYCOOEZPFM9HPDA9XJBB9EZCPUKILAIXEFMEG9PTNVRVIZMXFYFYPBHEANRS9XQZOZKTSXUNIZPPZDRRO9LRUTMWSBDPHDYJA9JQREHZWVZCDDFEEJXODGSYQGZEYEZXAJJDKHDFTCYBE9HADWEJBYDITEDMVXSHC9ZHMMKXLA9TGZN99KMCLZWBMUA9MSDGASTM9RDQPFFHCGPKVXHTGVJ9GATVONTGOYUGLQVKZLOWMSAEQFIMJYAKSYA9YKVTJOJOSINAOXV9MAQUGOURKZDXSKEMATUBGGKDRIGX99XHUICRVVDTYWRJYDMNBJIQDJVQLXHBDVWAKYPGJONCBUICUFQTWVXX9VJNYUKAHASQSEHCDKIHLNZKFMDQURWVDYLKJHVQTCDRMCZEPNKPBMSINNWEQFOGBLIZFGSVNJAACKYIXMQXPMEDOPCNUXPKRP9TMYWXDLOPJQTFHPSRQTRRMF9QEOZDD9JCBKGORANZEBESVPKTGCRCIGGSLMFLEZGJXFLQCJHDQKY9OH9DFF9AXZQWEPVRIOH9PAWBFZLXFKPZDODYROUDYJRMEWMBVZWXJWXYMYEIQDZZKXWXDYVHMXPMBJ9QSOJIZIZYUDZCBAPKXDWNU9FSWIKTMNQCWGJYDE9R9OZSFD9HEUKTJKXQFUSEJMQVUMNNYTWNTHNPODHFGEDBWQLSPZBQKGSIQVNOCXTHJWFQEZSLBXARGIISLFYZYHNKEVGHXNMZQWKYPNHRH9FUQCZH9CSWPITQRKQGNNFZTCHN9JNNZ9MZENMHBSNIXWAAADD9WKAFEHWKEWJUSFOFJMBULIIYPLIREJROPYASNXHXSLQXWTFVNNWIUHVLDXXTMNAGHBVWAEINAQTOO9FWQMGIAF9PZFYGEMRCXITWQWHVOISHXUHRSJJUVKYKJLZNMUWWGVQESIQTJXZKEITBRGNTYKULBFODPUMWXKMEQLZ999999999999999999999MINEIOTADOTCOM9999999999999AHGWHZD99A99999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWXHBBNAAY9GHWJCGKCEFUEVOBSOWZGPUILKRGGPEQ9BLVFRPBEMXYMIYPSTJHKG9QIBAYVVVSAALQD99999LGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999MINEIOTADOTCOM9999999999999MQZMETELE999999999MMMMMMMMMJYIPWHUOFJYBPNOHGZTVAKWBUVU",
				"KBFYZAUCZGPDNUYDURLDJHJ9ZISABKTXOTKHDUNFNZCKSHEEADONVIEBUMFSICJOETVCJQZLTMMQA9ERBHBWEHNHW9PCXNBZOKVCBMCWTPVUTTHN9PQDFTUSFOZTCDK9PSXFBEQWDEQZJIKGCIJUWLUIDQXHL9IIPXTQP9WS9VIRQAORMKVSDNFBVVKRXCCAQMLUALBJTIPKPNPJHQSRXKLKCXXLC9MBPFSMKPNJQAFOJMQBJKDKQJ9YOJWELOOQHOQNOGHPMBUHONFZIIXUOVZOQXM9KRPXHZXNPFXMSYNVFEFOMICFW9TFOUQNUP9DCO9WCBZUGVAFMHNNSNCJVQKMIFL9MRESEUNQEJUKSAVHFB9KIZCQOYSHEZFBD9JJACF9BXUE9ODOESNBRATQXMTSCJSGUIWHJWMINFXIIYAH9BDWNROMRFZGHZYTBPQEORKD9WCOOPKNXIBRZAKMLJAMIMDZWLWLQKEFIZXAQROTAEFVWSCRKPSQPLXJVAJ9IFMHUGOOQUOARFHXAZROEFKIKSWLGFNXSOINFNTB9HBZDDZNYFVBD9DJQECNQBQZBVEEHDEOZCRKIFJBFXJTXGBZXPHPATJPEXTE9QORJEQHNHEUAWCZCWGFCLQTIWWJOJOPLQUWDAGNFMPNSE9RVJNMPTXZHECSHYJHTA9WGYHWIZNPPYEPMTFMRZN9TBNANM9LUSWINYCMGMS9HSN9E9BKC9RKOCWTBTAYTZRUNBQMGKBIRD9TVDVYRDJPCITZGTRQQWBQJCOUWZEQXGWBESBBQHPEEBMXBXSXYNRYAWZUNYLSQDUNHDIGKCQSPLJHWPIMAJOQLLXUCTQORTSHFDUTZREPHCJASH9YZUGGFJLRTQFVMBWVWPCNQMC9JBMQCFBAXDAUPZLVKCGDUHFXHBGVCIRLJBTFCKFG9KFTBSNNKOROSRCNBKGHFZJLYOREG9XQRNDZHTZDWSRFZNRHODIUHVNNAPQJSNJEVIZPPZDKGYPYFBIZGTPVEWBR9BCOFIXGCFPJGHNNAXQEYFNQELGXZXKZAVBFDLHYUIGZKJLYCCVNCISQYMGXMSTJWMLBM9LBSJOMZPZQYABLRDKGVNIYRJVFUQCKDAORTXSAQDBDZAL9EBVZHQTZ9FIVO9KUTMVDWNOTIPJQUEYRGREXDYRVHKZ9N9PMVRWCDEULUODQZPDYTMKBRBPAEOGO9MDRIAKSCCEIGXIDLJTVW9SIUKMOYLPVWEOKBHCQGJEFQNTHYWXKBVDRWSPZBSSOAHMSPHLNRRHSNQMNQA9DAJKCESOLIKKCKIAWTFVSOWXOEKZTUOCJFHRBZWM9SDXZTWOZDTJRKLNAZXCCZMKOPYXJPQDSWW9YQRVTXNUT9RSWDGMRODRKMMHCTVCFYIULJPTRWJNGMKFLCMXKTABSJNBJBMEATJRPZJDDNAEIHJVVKCBOLQSMNXJ9QEDCRKWOYOFHUOYBVN9KNVTNDDAPIVMIYBBJSPQ9BAXSWFQ9QCSF9HHORXVASKPSIWRYD9SETSKCYT9QYRA9ENHBHIBFAROCVJAEKAVBPSWFUAEBDWZXLFXQRJJBUYDRFQLMLNVDHJHRFEGLOTYGESAOXEPCVAT9YSAJSGJGNCIK9CFGYHMHCFWHTBNAOV9OFNPC9TGWJJTOBEADHUDYQNDNYYKQAPJ9JKEBVZQLFUISAGEXWYSLNXPHVBYAAY9EXJJOJNDZMHYLGDKHOBPOBHHYQKRRALBMDEJWKJBPAB9JSUEDKRPQFJLD9ICSDSZGKZEVKLEBTCICITYITPLFGQ9JTJQPZEYPOMNNEYHQZRBJRNBWUKWVP9LPERBXWCSOXBGUWVJPYNFAWJ9IJQXOBVLGIHWDDQ9PJYF9AONOOTFECITZKPSNTJLGPISULEXGRSBDDTVTQCUDUEWMJ9KT9TJHMQFLTFQDFMECIPY9WOXVQHUVVMJAXOHPJKTAVJSVBTCKOKLZFRTVUEZRGPFISRMRSHLZQBFFMENXDMQL9DQBWOJFNK9UDFZAMVFNOGGYJOKVTXQFHXJCGPVX9FHYZJYBOSIHGZHFPMKWRHSS9HZGTRNFDJXIZOHQKLXIEHJKJSKYJCVLLOQJBWAWTMPGCCUBUDAEUVJQTDASTKVLPIDLGFAABZTVCWEUQACASZFKI9ACCYKHECKFOKM9NRD9UACQMGIAF9PZFYGEMRCXITWQWHVOISHXUHRSJJUVKYKJLZNMUWWGVQESIQTJXZKEITBRGNTYKULBFODPUMWX999999999999999999999999999MINEIOTADOTCOM9999999999999AHGWHZD99B99999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWX9TGCJUR9WCKWVPDQXEWYCXIL9TSLYCRBCSISCOFRSXRWYEOOTNULLUJQXQEQMGEXK9KFUORYOGHCZ9999LGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999MINEIOTADOTCOM9999999999999PKXMETELE999999999MMMMMMMMMXRBQBGMXPMBQMLPOYTSOQVQDVNA",
				"999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999WHOEHZVGLRPYPQATCPAULHGWLT9VQPPCRYXQPAHZOTFRMFVXEUGUZA9QPRKZNMGUHMWLXYLSR9RCILQRCKNKEOA999999999999999999999MINEIOTADOTCOM9999999999999AHGWHZD99C99999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWXLGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999EQHDYUJCZGMVMZYLX9GNZQCDAQYHICVELAVJWUGH9NZJCMNGPVZOJCGLENQX9EYKKUJRGZKXYLZN99999MINEIOTADOTCOM9999999999999FCXMETELE999999999MMMMMMMMMSUSGEIWOHIJSVSOWDWYAWJWGPEN",
			}, nil)
			Expect(err).ToNot(HaveOccurred())
			Expect(ValidBundle(bndl)).ToNot(HaveOccurred())
		})

		It("returns false for a invalid bundle", func() {
			tx, err := transaction.AsTransactionObject("ADXCBDTCXCCDHDPCSARCCDAD999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999SYW9TZUZIRLR9SKTGTINGHZMJQXIQNVDT9NNEBHMBI9IGEQFUZSULZYZVAMRGCOOMIDFJKTF9TKFMJTPDEZKD99999999999999999999999AUOEIOTADOTCOM9999999999999AHGWHZD99999999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWXRTQTHZSSPBKNZUPPZCHBQXZHDXPJHFBVYDYXRJBP9PT9J9CDDILDLFCAVMEOQ9PDVXFASAUVDYB9Z9999LGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999MINEIOTADOTCOM9999999999999ZA9METELE999999999MMMMMMMMM9BNPYHCWUMDDVKNDUWX9KN9O9ZP")
			Expect(err).ToNot(HaveOccurred())
			tx.Value = 1000000000
			bndl, err := transaction.AsTransactionObjects([]Trytes{
				// modified deposit value (bundle sum not 0)
				transaction.MustTransactionToTrytes(tx),
				"PLPAOU9KJGDRECJOYVOGPMAUTOVSSIS9REDBVBRQTADVPISW9MJBLGXHUNOWCDSITOUPXUMWNXFBIVAZDMNQHSFFUFSIJGEDRWUWMWNRXFPKWPOWLPYBMSYRNBAJWATLWHQBRNZWPOVXXITRCKWLKWTYGHX9UQ9TIBWYBRWXCTGNYCJYBAEXGTQPZFNE9PGX9IMQXWYHSGFZYTIBENNRUGAOXXQZZNLXKIVGUYYUELMQHNEYCYBPJGQVXBHWYOMQBORISBFBRZLJFJMVLXXDSQBPRGYUXUW9HMCLHD9YYYBSY9MIDMJHXGVQRUUU9LNNMGBBRHBZDMOMAAQRAPNJOEVCXZZMGUBSB9O9MLQSUYNCWKBSJYXQPIRIJIYDWGHWUMAXIWB99YM9GZJQOYOYABAEBHINQVPRXFKEJRMDBGVVWMQWQNHRWFHCKDFGGQMIOTMMBCVRYEEEDZJSMCWDSFFB9QUMMTBIRR9KUBZVYSFGIHWHGLVXZNHYBWVEBERTJRREJUHTITCDNDPWQKFYTBCXKRNS99SFHCQNUUL9SMMVS9YBFQ9UQHYBAPCWHULJRMHFKBWSKWOUUVNVWQOIBVZZUPYGEEWGRDVSSCWXZDYMZN9VLJNFNCYIQSKMDHLGAKTAEUPXPCUYZ9AMGFZMSBDPUNNUVP9P9QTMFUGINRNJCJYJKBS9P9NLDAPCEATATOGMRCGJSAAALLGZNOWDFYOPWMAQMFTKPUSLTZKKJTAJLRAVRP9EXRZGMKIKZPBJWYPUEWIIYXSEH9HBCCUBFWGOURNYLENBEB9QHTIIJXDJ9QHIUITLAJCIQGJXIXOGMCWRGBIISXTDWQJCBFKQIX9RJMQZGXKZBMKFXHXGBLXAGLDZRIGGTETCDGWPQIZOEXATGCHEMAITZRPIKDYTJJJVBAJIDNGLIVPS9CMAYRHVYEULFVFIGLXHNO9NJCUKZ9TGLQUJQKNWDVUSBKCSHQFTRQCYEKT9ULRJMAOC9HTL9ZRUHIOTGHPYNLAZEVLEDESXWHZOL9DKWPZBOWIUKHV9IIOTDXHELGGMMVAAYOITSLVCWBKWFGRUJFIXYRTELSMFCZGKMAPOYGQLGBQXDPGGHLYBQPVNJUDBOLGLRBALAXELHFIIZAZLXMAE9VVCBBEQNMSIOEUWIBTQWSSZBB9LDGZLSJKEDLMJUDRDTAWGPBYVNJ9XBR9YWRHSXCAKUMWYPFUXX9ANVPIRIRWDYGCKTYRTBNFQUHVVJFSFPNGPTFX9FDYFMTADCTKGZEHGUEPKPCCYIFOMXXGCQJBQXESRYCOOEZPFM9HPDA9XJBB9EZCPUKILAIXEFMEG9PTNVRVIZMXFYFYPBHEANRS9XQZOZKTSXUNIZPPZDRRO9LRUTMWSBDPHDYJA9JQREHZWVZCDDFEEJXODGSYQGZEYEZXAJJDKHDFTCYBE9HADWEJBYDITEDMVXSHC9ZHMMKXLA9TGZN99KMCLZWBMUA9MSDGASTM9RDQPFFHCGPKVXHTGVJ9GATVONTGOYUGLQVKZLOWMSAEQFIMJYAKSYA9YKVTJOJOSINAOXV9MAQUGOURKZDXSKEMATUBGGKDRIGX99XHUICRVVDTYWRJYDMNBJIQDJVQLXHBDVWAKYPGJONCBUICUFQTWVXX9VJNYUKAHASQSEHCDKIHLNZKFMDQURWVDYLKJHVQTCDRMCZEPNKPBMSINNWEQFOGBLIZFGSVNJAACKYIXMQXPMEDOPCNUXPKRP9TMYWXDLOPJQTFHPSRQTRRMF9QEOZDD9JCBKGORANZEBESVPKTGCRCIGGSLMFLEZGJXFLQCJHDQKY9OH9DFF9AXZQWEPVRIOH9PAWBFZLXFKPZDODYROUDYJRMEWMBVZWXJWXYMYEIQDZZKXWXDYVHMXPMBJ9QSOJIZIZYUDZCBAPKXDWNU9FSWIKTMNQCWGJYDE9R9OZSFD9HEUKTJKXQFUSEJMQVUMNNYTWNTHNPODHFGEDBWQLSPZBQKGSIQVNOCXTHJWFQEZSLBXARGIISLFYZYHNKEVGHXNMZQWKYPNHRH9FUQCZH9CSWPITQRKQGNNFZTCHN9JNNZ9MZENMHBSNIXWAAADD9WKAFEHWKEWJUSFOFJMBULIIYPLIREJROPYASNXHXSLQXWTFVNNWIUHVLDXXTMNAGHBVWAEINAQTOO9FWQMGIAF9PZFYGEMRCXITWQWHVOISHXUHRSJJUVKYKJLZNMUWWGVQESIQTJXZKEITBRGNTYKULBFODPUMWXKMEQLZ999999999999999999999MINEIOTADOTCOM9999999999999AHGWHZD99A99999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWXHBBNAAY9GHWJCGKCEFUEVOBSOWZGPUILKRGGPEQ9BLVFRPBEMXYMIYPSTJHKG9QIBAYVVVSAALQD99999LGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999MINEIOTADOTCOM9999999999999MQZMETELE999999999MMMMMMMMMJYIPWHUOFJYBPNOHGZTVAKWBUVU",
				"KBFYZAUCZGPDNUYDURLDJHJ9ZISABKTXOTKHDUNFNZCKSHEEADONVIEBUMFSICJOETVCJQZLTMMQA9ERBHBWEHNHW9PCXNBZOKVCBMCWTPVUTTHN9PQDFTUSFOZTCDK9PSXFBEQWDEQZJIKGCIJUWLUIDQXHL9IIPXTQP9WS9VIRQAORMKVSDNFBVVKRXCCAQMLUALBJTIPKPNPJHQSRXKLKCXXLC9MBPFSMKPNJQAFOJMQBJKDKQJ9YOJWELOOQHOQNOGHPMBUHONFZIIXUOVZOQXM9KRPXHZXNPFXMSYNVFEFOMICFW9TFOUQNUP9DCO9WCBZUGVAFMHNNSNCJVQKMIFL9MRESEUNQEJUKSAVHFB9KIZCQOYSHEZFBD9JJACF9BXUE9ODOESNBRATQXMTSCJSGUIWHJWMINFXIIYAH9BDWNROMRFZGHZYTBPQEORKD9WCOOPKNXIBRZAKMLJAMIMDZWLWLQKEFIZXAQROTAEFVWSCRKPSQPLXJVAJ9IFMHUGOOQUOARFHXAZROEFKIKSWLGFNXSOINFNTB9HBZDDZNYFVBD9DJQECNQBQZBVEEHDEOZCRKIFJBFXJTXGBZXPHPATJPEXTE9QORJEQHNHEUAWCZCWGFCLQTIWWJOJOPLQUWDAGNFMPNSE9RVJNMPTXZHECSHYJHTA9WGYHWIZNPPYEPMTFMRZN9TBNANM9LUSWINYCMGMS9HSN9E9BKC9RKOCWTBTAYTZRUNBQMGKBIRD9TVDVYRDJPCITZGTRQQWBQJCOUWZEQXGWBESBBQHPEEBMXBXSXYNRYAWZUNYLSQDUNHDIGKCQSPLJHWPIMAJOQLLXUCTQORTSHFDUTZREPHCJASH9YZUGGFJLRTQFVMBWVWPCNQMC9JBMQCFBAXDAUPZLVKCGDUHFXHBGVCIRLJBTFCKFG9KFTBSNNKOROSRCNBKGHFZJLYOREG9XQRNDZHTZDWSRFZNRHODIUHVNNAPQJSNJEVIZPPZDKGYPYFBIZGTPVEWBR9BCOFIXGCFPJGHNNAXQEYFNQELGXZXKZAVBFDLHYUIGZKJLYCCVNCISQYMGXMSTJWMLBM9LBSJOMZPZQYABLRDKGVNIYRJVFUQCKDAORTXSAQDBDZAL9EBVZHQTZ9FIVO9KUTMVDWNOTIPJQUEYRGREXDYRVHKZ9N9PMVRWCDEULUODQZPDYTMKBRBPAEOGO9MDRIAKSCCEIGXIDLJTVW9SIUKMOYLPVWEOKBHCQGJEFQNTHYWXKBVDRWSPZBSSOAHMSPHLNRRHSNQMNQA9DAJKCESOLIKKCKIAWTFVSOWXOEKZTUOCJFHRBZWM9SDXZTWOZDTJRKLNAZXCCZMKOPYXJPQDSWW9YQRVTXNUT9RSWDGMRODRKMMHCTVCFYIULJPTRWJNGMKFLCMXKTABSJNBJBMEATJRPZJDDNAEIHJVVKCBOLQSMNXJ9QEDCRKWOYOFHUOYBVN9KNVTNDDAPIVMIYBBJSPQ9BAXSWFQ9QCSF9HHORXVASKPSIWRYD9SETSKCYT9QYRA9ENHBHIBFAROCVJAEKAVBPSWFUAEBDWZXLFXQRJJBUYDRFQLMLNVDHJHRFEGLOTYGESAOXEPCVAT9YSAJSGJGNCIK9CFGYHMHCFWHTBNAOV9OFNPC9TGWJJTOBEADHUDYQNDNYYKQAPJ9JKEBVZQLFUISAGEXWYSLNXPHVBYAAY9EXJJOJNDZMHYLGDKHOBPOBHHYQKRRALBMDEJWKJBPAB9JSUEDKRPQFJLD9ICSDSZGKZEVKLEBTCICITYITPLFGQ9JTJQPZEYPOMNNEYHQZRBJRNBWUKWVP9LPERBXWCSOXBGUWVJPYNFAWJ9IJQXOBVLGIHWDDQ9PJYF9AONOOTFECITZKPSNTJLGPISULEXGRSBDDTVTQCUDUEWMJ9KT9TJHMQFLTFQDFMECIPY9WOXVQHUVVMJAXOHPJKTAVJSVBTCKOKLZFRTVUEZRGPFISRMRSHLZQBFFMENXDMQL9DQBWOJFNK9UDFZAMVFNOGGYJOKVTXQFHXJCGPVX9FHYZJYBOSIHGZHFPMKWRHSS9HZGTRNFDJXIZOHQKLXIEHJKJSKYJCVLLOQJBWAWTMPGCCUBUDAEUVJQTDASTKVLPIDLGFAABZTVCWEUQACASZFKI9ACCYKHECKFOKM9NRD9UACQMGIAF9PZFYGEMRCXITWQWHVOISHXUHRSJJUVKYKJLZNMUWWGVQESIQTJXZKEITBRGNTYKULBFODPUMWX999999999999999999999999999MINEIOTADOTCOM9999999999999AHGWHZD99B99999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWX9TGCJUR9WCKWVPDQXEWYCXIL9TSLYCRBCSISCOFRSXRWYEOOTNULLUJQXQEQMGEXK9KFUORYOGHCZ9999LGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999MINEIOTADOTCOM9999999999999PKXMETELE999999999MMMMMMMMMXRBQBGMXPMBQMLPOYTSOQVQDVNA",
				"999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999WHOEHZVGLRPYPQATCPAULHGWLT9VQPPCRYXQPAHZOTFRMFVXEUGUZA9QPRKZNMGUHMWLXYLSR9RCILQRCKNKEOA999999999999999999999MINEIOTADOTCOM9999999999999AHGWHZD99C99999999C99999999BXMKIBXAKYPETIHGFOHRBZSQYEVXCCARVZDFQGDYQLHXOJZYB9DASXMTOXFK9JVJLIFAGTHIBXSBTCOWXLGXB9IGNMJFRRFMNMQYWJVSSYVNTETTKAMTNKGQEBXUQVTSKHEEI99UYNMWUGJOYMNWLFGAHJEQLZ9999EQHDYUJCZGMVMZYLX9GNZQCDAQYHICVELAVJWUGH9NZJCMNGPVZOJCGLENQX9EYKKUJRGZKXYLZN99999MINEIOTADOTCOM9999999999999FCXMETELE999999999MMMMMMMMMSUSGEIWOHIJSVSOWDWYAWJWGPEN",
			}, nil)
			Expect(err).ToNot(HaveOccurred())
			Expect(ValidBundle(bndl)).To(HaveOccurred())
		})
	})

	Context("GroupTransactionsIntoBundles()", func() {
		It("returns multiple bundles with the correct transactions", func() {
			txs := transaction.Transactions{
				{Bundle: "1", CurrentIndex: 0, LastIndex: 1},
				{Bundle: "1", CurrentIndex: 1, LastIndex: 1},
				{Bundle: "2", CurrentIndex: 0, LastIndex: 1},
				{Bundle: "2", CurrentIndex: 1, LastIndex: 1},
				{Bundle: "3", CurrentIndex: 0, LastIndex: 2},
				{Bundle: "3", CurrentIndex: 1, LastIndex: 2},
				{Bundle: "3", CurrentIndex: 2, LastIndex: 2},
			}
			bundles := GroupTransactionsIntoBundles(txs)
			Expect(len(bundles)).To(Equal(3))
			Expect(bundles[0][1].Bundle).To(Equal("1"))
			Expect(bundles[1][1].Bundle).To(Equal("2"))
			Expect(bundles[2][1].Bundle).To(Equal("3"))
		})
	})

	Context("TailTransactionHash()", func() {
		It("returns the tail tx hash", func() {
			Expect(TailTransactionHash(Bundle{{Hash: "ABCDEF"}})).To(Equal("ABCDEF"))
			Expect(TailTransactionHash(Bundle{{Hash: "ABCDEF", CurrentIndex: 1}, {Hash: "BCDEF", CurrentIndex: 0}})).To(Equal("BCDEF"))
			Expect(TailTransactionHash(Bundle{})).To(Equal(""))
		})
	})
})
