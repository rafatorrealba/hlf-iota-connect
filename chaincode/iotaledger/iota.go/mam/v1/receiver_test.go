package mam_test

import (
	. "github.com/onsi/ginkgo"
	. "github.com/onsi/gomega"

	"github.com/iotaledger/iota.go/api"
	mam "github.com/iotaledger/iota.go/mam/v1"
	"github.com/iotaledger/iota.go/transaction"
	"github.com/iotaledger/iota.go/trinary"
)

var _ = Describe("Receiver", func() {

	Context("Receive", func() {

		It("Should receive a message from a public Channel", func() {
			fakeAPI := newFakeAPI()
			fakeAPI.findTransactionObjects = func(query api.FindTransactionsQuery) (transaction.Transactions, error) {
				Expect(query).To(Equal(api.FindTransactionsQuery{
					Addresses: trinary.Hashes{"PN9CYZTVHPKVRVBOOIRZDZSHQLURKQYSQTTDOGAKZZ9SCGIWTTOBPRWVPZRHZJHIWOKLZE9SQJWGPGFTXUMUPGBBN9UMUPGBBN9"},
				}))
				return transaction.Transactions{
					transaction.Transaction{
						Hash:                     "YJLLUHLGJNZNMT9JGIHNOTPUNHHZWSOC9NCUFYYUNX9VNVMSWIDYAFBYTBBCVMJUOLDZESRWTVZX99999",
						SignatureMessageFragment: "HH9ZURAASMZCC9EESAHNIFQJRUEPETKZCWWYDHXHUYZOUXCUI99TUATEHWVPIZQYHWYOBNSQWZKKUVRZQHTPJEPAJFCBWOXRZMWUACSUUIADMCMV9ZYYNAYLDZMFSHSAVVXNQOCZDOGMQVCJLEBGAYNGYJKOPDHBVDKBGVVCSQIBAHVFJOHIKHQKSDMTCVHIAQUB9ULLSSUUUVKI9X9AYY9FBRWZDONSKVFQRIEIYMFFWVHUT9EZMDVSDHNTWAIKEWZFUARBPFJZWEBEYRDRNSSHOQWJAWTSYTFMYLDGTTXMWCMALHJFBAYIESEBNBEZCZQJGZPAHDADUULD9UDRXCDPOFIPKBLL9RUPPIMH9MEJSUCWGQMKBVFTAZSOFPUQHXUQBJCACNHCHGJYVGHJPUKSMZQWVSPBTQOGTALQUQXUCVAXRBKRSJZPXQIWBRIIEOC9JXVTBNEBAOZBOOOPPTNKMYJCDEFJJQXAIOIBLCSPFFSDGVXYKNUPWMVOEMCJXMVLYSFFRBUAAYXROCEYIER9SBBGJRJRNBOBKAZWGSEY9FK9GJBFZY9LBBT9GXIAKKCQEBZASGUSDFDUC9QYSTPAXPLLEUSKIMJDOVCAFYKSP9WGB9A9YDAQCDNTHJJQWCZHIQTQYKPBXMTWNSBKZJESTVURV9PKJFAEEUCVFXXMNBMOE9GTYNJV9TUJKPQEXOIEN9NEZKWXXDZBTIGXPNBHMNQGEJ9HOFGHUAAVHXO9UBNZOQFKFRDTIOKBCSPYPZ9QEATBLCHXXPNPEXTYGZHDRSYVCMBGK9XQBSECRXJSKD9QFFMVAFDAIYWICUSDKKTKMPWHCHMMNHDTGXYBLTOQTUMQLPFLFGLWEALWFCFEYXQKOBTVH9GIAFHLNQDPIZOAPMVRFWDQDQKMNDJVPCNL9IVRDMEZSVUSGDCH9IFUKQZCJUEMQMQFGTLWTUBGHBYLKKWJFWUVTVLMQALCIPTJUEMRXAGGXSHJQCYZXDNTFL9FHYN9JTUTWJBJWMKVPDXFIMOOBBRUYP9SZZHNKOHCWY9DNQWZKDYTMPCD9OKRCQXTZKIIMGXNBKAAQVBHXULWRGCEVOSPFJVKGIQBGUUVEVHTCZBQOFOIERIYCDKZ9JCNPUUQPAQEM9UXOMBICNYBNXIKTIWVNNUNJCBOVOXV9YCYQUPJJGRCOUVKSELOQECMOACRCHHTSFWWQGBZT9QYTQPDTXLVVPQXADFDR9DMEPIVIUTBJYBDVROEIEVPTBLIZWI9DEVCNLTWYILRQTRKYNAHSEJJMZLIAOF9JSWPHYSWSRYDDUMMTKIACLFJGQUXKFFFXHGHXNTLFHUKHMW9REHQSQGZHMMXMIVAPOPM9IULJPMBFTHOJIZDECOFFALTSJXEVBHNPCMWWJWOVOOPQHHBGMMXGKAMMOLHHJVYCCSQMBWMCXPRSIKLEFZPLXTEUPITXCQ9AUMTAXORLWUJZBZFCYHAHBDKMMCUVQZ9VUJQCZSBRPEJLWNTGLKYRGTOEMVENSRJWPBVYNNWBZBMXTXSYXKIOCPYOKVNCVIIHFIWHJPYVAOYBW9SCFLLUMQACVYYTWZK9SBPCPAJTRRJSBDCXSBSHTHDEKKXWKYBH9TCQGJOQRKXMFVDFOFNXPMVB9XVYSJURFGPMOVADOCQXXRKOOZYLKQEDKCKAKGLICDPGCVZV9TQBIHJFPKFVO9VQDAWTKSPFSHJW9D9VRGIQPGJNFNMGVXBOOUKYCCJNW9VSFLYHLJIDDXEBKXYLQNROYQSPIZBXETKOPJXVEWCVWZTVEZMQJYTYPYEAQTQYOXVNKRFGOZXZQIKOBQSUHVMXRKXSEHPIAZPYGNZXXWB9COQV9MVLSXZJICFLEOVLZFWIA9JUIPFIOHXFXVBYXOHKY9RWMEVWCYRDHBEOZ9MAPOFT9WNEFBBURIQUN9RUSSM9FQFUSNOPTZLJIPYV9SDCO9EJRMQIM9JPRYCEUTM9FOXNRIZTGUP9XKXLGA9CNYQEGKOQOAZQEPIMDWL9XAPCIBAVMMZBLIQEWFWWULEPXIMPBJORAHGSMCHDNSQMMWVKGCGRLFLA9ZHHMJVCNNSNETRIBQTPDB9MX9VSNSEOQIK9SZDITUMMESYKJYD9YKZKCOYIUHLYOZFWJEJUACE9STXQB9RHLL9YVNITZIULZYUJNH",
						Address:                  "PN9CYZTVHPKVRVBOOIRZDZSHQLURKQYSQTTDOGAKZZ9SCGIWTTOBPRWVPZRHZJHIWOKLZE9SQJWGPGFTX",
						CurrentIndex:             0x1,
						LastIndex:                0x2,
						Bundle:                   "FGEYEVYLIYESSZTIBXAIDQSK9QSJSX9JFLYKHETYIQRCWVRBVWIDQJBEUSHOIKRLJXLPSGWALTKFXSVCW",
						TrunkTransaction:         "VSAASONOCUUTNIVXUJ99ES9ZPPWVZOZBAIHL9ALHYDLYNFXSDYIOVUFHBZKVR9ETZDZHI9YHZZYO99999",
						BranchTransaction:        "CTHMUYWJYAICTJDPVKVIHDBLYDUKVVQPWKXAUW9FATKLSRUVSRTYAHYMTXYNJSZZSAOEXSXSYOLTZ9999",
						Nonce:                    "POWSRVIO9LVB999LNVMMGPTNNNV",
					},
					transaction.Transaction{
						Hash:                     "VSAASONOCUUTNIVXUJ99ES9ZPPWVZOZBAIHL9ALHYDLYNFXSDYIOVUFHBZKVR9ETZDZHI9YHZZYO99999",
						SignatureMessageFragment: "RDYUTFNZSKEHVWXFYVXUWYPBEUFULLNQRYYRHJRYNRMPGSIVRDPIAYIVKZNLECLRPVCOLPCVLTSGHCDSYUEYAV9QPLHO9VJ9AZQRNZQSJBNZCIMMBAAGB9YXKINSN9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
						Address:                  "PN9CYZTVHPKVRVBOOIRZDZSHQLURKQYSQTTDOGAKZZ9SCGIWTTOBPRWVPZRHZJHIWOKLZE9SQJWGPGFTX",
						CurrentIndex:             0x2,
						LastIndex:                0x2,
						Bundle:                   "FGEYEVYLIYESSZTIBXAIDQSK9QSJSX9JFLYKHETYIQRCWVRBVWIDQJBEUSHOIKRLJXLPSGWALTKFXSVCW",
						TrunkTransaction:         "CTHMUYWJYAICTJDPVKVIHDBLYDUKVVQPWKXAUW9FATKLSRUVSRTYAHYMTXYNJSZZSAOEXSXSYOLTZ9999",
						BranchTransaction:        "BZWSJSIGOCGELCBNELWXHQKNXZVHWSPFMIMI9CMBEZITWJNVNNCOWNSVQBFLIUILBQSUUCUIFGPW99999",
						Nonce:                    "POWSRVIO9LVB999UNTTPPPVNNNV",
					},
					transaction.Transaction{
						Hash:                     "FPZSZEPOSNZVCMDNIJVBNRJHMUXBKRIFEHBERVQCRJXJCIAXGEUHFJKKAZTCDBNWCFPZYUADQDPA99999",
						SignatureMessageFragment: "AZBCBCDTA9YWALKBOBQCBHBEOGVFTJGQGFVH9DDBETQCYZLHSBQQOEXKHVCRLBOTABTUYEJDNHXOBLWNITRDDKYCJOJVSLUDPBOYJ9WMLNDFWXKDAAJZDAIUUMLPVQMWIYJYE9G9BEIHBOQBKZZSLXBKGPDLPYRFLJPUTJOAJZELNGZFQBEPP9KNFNBQCQIBANQFLOQLQMFNMKDYJITRVLPDCWEBENYVT9GVPELRCMOHXPTCJMEEQLQGM9QG9WKHWJTBGXBVALITU9WIECZMQJLADX9WPIFB9QWLKBTEL9FTKLAQENDRESAZNSYGWCDMKO9GKVED9SXZKOJONWWIPKCTCCFBWYSCFAJPIQOCCCPLXZSNQJ9APQPYQMHQZBICSTJQIIHOSJKCZBFTMHEKPHOVYUXTBGOV99BRHKVFXOJO9QUCFKAUCZCSIFHNBRUNWSXOQAHOYHKHXLBRDSWHMPFEXLVEZWGLNAJOQSANSEJM9UOORSAWTNWIUPM9OJYMYHZDCF9LQYYYYCPQ9MAU9ABZPLLDTPISQBKIZMSOURGLKSQV9AXPFOBIPUNBQGZOMUGLJYBDXXWRJYOIXQTRVQYYOZAJ9YOFIVFBMRABSJFVNNMTMPYIEGNNPQEAPDXYYIIRNYVYUN9KAICLDLEDMGM9MKMAOMKNJTFJFXW9KRDELIPXMTSQFKHVMBP9VOS9SIFTCTHFQHNLAABDYOQDRUSI9MFUVTCWZB9CWRVZZQASQROBORXB9K9RXYOQNTPC9CNMHRISBQFSGNBGAOCYEHSVGV9PG99CUGFPTINEBWFUXUFICLWSVFGQVEJIUAWXGPXXXSTGQI9XHETTXFGYETDNUSVSAPNDOBVNWOG9AANDIIOKCWGF9NQYPMEWQPZGPHFIZQPV9BJGHSZGJFMXGJBMSVWFZYCSEYOPGCNJOZPSNHHYUVUMCHWYDJJDGNRJZXDTLWSHZVBVN9BLQKRAKKGQAYVPODVJDSUJRZHKKKPXVURBAACAUFUANUSCVFIYAUFDRHGHVNNBZVIVLJWNJTILTHGJM9UJSYBBZKOIBQXFRGEELNYLKGXWCUGXWL9XANUK9ARKCDRXXGTPN9OIUUSLJQJMYHMVVXMRMBXIAAZMRHZOPYOLLUAZCFRJSLRMXHPLGJCWOCPXRUIRXXHMKWQIQNZMANMAAJKDOLOLNKGESNAGKR9DCSJVWJWXKD9C9GHCKYRZWMPZUOBUCOAHAFINTREHCTZJCOVRDIBOFXMHHODGWSYBOQHQNG9PEOHUZXJRAKAOOSBNOJJAFFVNHLDKBVZIXNNINO9UDVMSEIROQBHYLLRKRMGAC9ORPOHABXJNXBHTIRMOPDLGSEBCNVEGCJIYZ9TFPHYAKICGBOMIHHWUAPFYMNBBRJNLSDWOVUBOIDJXXULJ99EHPYMLCDJI9NCORXTV9APH9YJSTOHUE9ENKFRKTSXT9ALCZNRYVHFYGSAHIKGURPCYPIUNGVRMDCUXXQXQOBRJRKQRQYMCDBCD9RXBFNBUARVRFTZLXZZXWWAFJKVBRGQDUUBDYUDSUXYOBPJMYTWYWPENKZOYMW9PALW9PCJZIXXUJ9RRVKDSPU9AGVPIZNWVYOECDOGZSTYCNRIGBKYVKRYFQJISNBNJOSEYED9HFPYJY9LTSIDYEUAVTUWFYGUHUNDPPVSPVZXPWUPHWRPULJYLODC9HXTZVJESQ9GQG9B9KTUYHIAGXVXOCZLUJBSKWTNYHGRAPTINBUINDHAVOINYETKGQ9OPMHZUQJFGWMPT9TWKHBMDJAWBWFIVSRBOLEZOYMLEDEDGWSKKIKNCYWFUVTFLUHEDHIOQVJVXXLQXETUSZJLUZA9BVTJTTMKSSXBPZLEAZ99XMRJBOHTMGUQSUXEFNKOKXBBNDMEUIBXG9ERVNSYFYFBGLJGIPPLQTVMVHBEMFNXLREVZEPHKKCAJNQ9AYPIXYUUUFACDEAJPHJYEQOBHUKCYTNLVVYQAKJBGH9UCSNALCEOGNBURFBTVFCNQHJ9GVBWQWMGPCQPEIKPSLLD9XXDC9XOZLPYINCYDJ9WPLBQADOI9GLAVGORRCPZDLTFKQLUDSRMFUHAXEVCVPBXQNWANKXDFKFRJ9GNIGATVAAMOFODQDBYMAKUXFOPZFAMXVAQXULGYLMTGHMONDZAXGAGYLSG",
						Address:                  "PN9CYZTVHPKVRVBOOIRZDZSHQLURKQYSQTTDOGAKZZ9SCGIWTTOBPRWVPZRHZJHIWOKLZE9SQJWGPGFTX",
						CurrentIndex:             0x0,
						LastIndex:                0x2,
						Bundle:                   "FGEYEVYLIYESSZTIBXAIDQSK9QSJSX9JFLYKHETYIQRCWVRBVWIDQJBEUSHOIKRLJXLPSGWALTKFXSVCW",
						TrunkTransaction:         "YJLLUHLGJNZNMT9JGIHNOTPUNHHZWSOC9NCUFYYUNX9VNVMSWIDYAFBYTBBCVMJUOLDZESRWTVZX99999",
						BranchTransaction:        "CTHMUYWJYAICTJDPVKVIHDBLYDUKVVQPWKXAUW9FATKLSRUVSRTYAHYMTXYNJSZZSAOEXSXSYOLTZ9999",
						Nonce:                    "POWSRVIO9LVB999OEKKKKVTNNNT",
					},
				}, nil
			}
			receiver := mam.NewReceiver(fakeAPI)

			err := receiver.SetMode(mam.ChannelModePublic, "")
			Expect(err).NotTo(HaveOccurred())

			nextRoot, messages, err := receiver.Receive("PN9CYZTVHPKVRVBOOIRZDZSHQLURKQYSQTTDOGAKZZ9SCGIWTTOBPRWVPZRHZJHIWOKLZE9SQJWGPGFTXUMUPGBBN9")
			Expect(err).NotTo(HaveOccurred())
			Expect(messages).To(Equal([]string{"Hello!"}))
			Expect(nextRoot).To(Equal("HTGAUZTBH9SIVJVREIXLGAPPVQOFZZCRWDYSDG9JLXLFREYRWBEOBPSCSFTV9XZNIVZNAZINBAFDEWUZ9"))
		})

		It("Should receive a message from a private Channel", func() {
			fakeAPI := newFakeAPI()
			fakeAPI.findTransactionObjects = func(query api.FindTransactionsQuery) (transaction.Transactions, error) {
				Expect(query).To(Equal(api.FindTransactionsQuery{
					Addresses: trinary.Hashes{"GQKALAAKWLAUKANTFPOZIWOGDNODDYZGGVKWISNYWFD9BAZGBMEWZRSIG9QAMRPBASMCLUACFICJSWRBWBPRBFMPZC"},
				}))
				return transaction.Transactions{
					transaction.Transaction{
						Hash:                     "YJLLUHLGJNZNMT9JGIHNOTPUNHHZWSOC9NCUFYYUNX9VNVMSWIDYAFBYTBBCVMJUOLDZESRWTVZX99999",
						SignatureMessageFragment: "HH9ZURAASMZCC9EESAHNIFQJRUEPETKZCWWYDHXHUYZOUXCUI99TUATEHWVPIZQYHWYOBNSQWZKKUVRZQHTPJEPAJFCBWOXRZMWUACSUUIADMCMV9ZYYNAYLDZMFSHSAVVXNQOCZDOGMQVCJLEBGAYNGYJKOPDHBVDKBGVVCSQIBAHVFJOHIKHQKSDMTCVHIAQUB9ULLSSUUUVKI9X9AYY9FBRWZDONSKVFQRIEIYMFFWVHUT9EZMDVSDHNTWAIKEWZFUARBPFJZWEBEYRDRNSSHOQWJAWTSYTFMYLDGTTXMWCMALHJFBAYIESEBNBEZCZQJGZPAHDADUULD9UDRXCDPOFIPKBLL9RUPPIMH9MEJSUCWGQMKBVFTAZSOFPUQHXUQBJCACNHCHGJYVGHJPUKSMZQWVSPBTQOGTALQUQXUCVAXRBKRSJZPXQIWBRIIEOC9JXVTBNEBAOZBOOOPPTNKMYJCDEFJJQXAIOIBLCSPFFSDGVXYKNUPWMVOEMCJXMVLYSFFRBUAAYXROCEYIER9SBBGJRJRNBOBKAZWGSEY9FK9GJBFZY9LBBT9GXIAKKCQEBZASGUSDFDUC9QYSTPAXPLLEUSKIMJDOVCAFYKSP9WGB9A9YDAQCDNTHJJQWCZHIQTQYKPBXMTWNSBKZJESTVURV9PKJFAEEUCVFXXMNBMOE9GTYNJV9TUJKPQEXOIEN9NEZKWXXDZBTIGXPNBHMNQGEJ9HOFGHUAAVHXO9UBNZOQFKFRDTIOKBCSPYPZ9QEATBLCHXXPNPEXTYGZHDRSYVCMBGK9XQBSECRXJSKD9QFFMVAFDAIYWICUSDKKTKMPWHCHMMNHDTGXYBLTOQTUMQLPFLFGLWEALWFCFEYXQKOBTVH9GIAFHLNQDPIZOAPMVRFWDQDQKMNDJVPCNL9IVRDMEZSVUSGDCH9IFUKQZCJUEMQMQFGTLWTUBGHBYLKKWJFWUVTVLMQALCIPTJUEMRXAGGXSHJQCYZXDNTFL9FHYN9JTUTWJBJWMKVPDXFIMOOBBRUYP9SZZHNKOHCWY9DNQWZKDYTMPCD9OKRCQXTZKIIMGXNBKAAQVBHXULWRGCEVOSPFJVKGIQBGUUVEVHTCZBQOFOIERIYCDKZ9JCNPUUQPAQEM9UXOMBICNYBNXIKTIWVNNUNJCBOVOXV9YCYQUPJJGRCOUVKSELOQECMOACRCHHTSFWWQGBZT9QYTQPDTXLVVPQXADFDR9DMEPIVIUTBJYBDVROEIEVPTBLIZWI9DEVCNLTWYILRQTRKYNAHSEJJMZLIAOF9JSWPHYSWSRYDDUMMTKIACLFJGQUXKFFFXHGHXNTLFHUKHMW9REHQSQGZHMMXMIVAPOPM9IULJPMBFTHOJIZDECOFFALTSJXEVBHNPCMWWJWOVOOPQHHBGMMXGKAMMOLHHJVYCCSQMBWMCXPRSIKLEFZPLXTEUPITXCQ9AUMTAXORLWUJZBZFCYHAHBDKMMCUVQZ9VUJQCZSBRPEJLWNTGLKYRGTOEMVENSRJWPBVYNNWBZBMXTXSYXKIOCPYOKVNCVIIHFIWHJPYVAOYBW9SCFLLUMQACVYYTWZK9SBPCPAJTRRJSBDCXSBSHTHDEKKXWKYBH9TCQGJOQRKXMFVDFOFNXPMVB9XVYSJURFGPMOVADOCQXXRKOOZYLKQEDKCKAKGLICDPGCVZV9TQBIHJFPKFVO9VQDAWTKSPFSHJW9D9VRGIQPGJNFNMGVXBOOUKYCCJNW9VSFLYHLJIDDXEBKXYLQNROYQSPIZBXETKOPJXVEWCVWZTVEZMQJYTYPYEAQTQYOXVNKRFGOZXZQIKOBQSUHVMXRKXSEHPIAZPYGNZXXWB9COQV9MVLSXZJICFLEOVLZFWIA9JUIPFIOHXFXVBYXOHKY9RWMEVWCYRDHBEOZ9MAPOFT9WNEFBBURIQUN9RUSSM9FQFUSNOPTZLJIPYV9SDCO9EJRMQIM9JPRYCEUTM9FOXNRIZTGUP9XKXLGA9CNYQEGKOQOAZQEPIMDWL9XAPCIBAVMMZBLIQEWFWWULEPXIMPBJORAHGSMCHDNSQMMWVKGCGRLFLA9ZHHMJVCNNSNETRIBQTPDB9MX9VSNSEOQIK9SZDITUMMESYKJYD9YKZKCOYIUHLYOZFWJEJUACE9STXQB9RHLL9YVNITZIULZYUJNH",
						Address:                  "PN9CYZTVHPKVRVBOOIRZDZSHQLURKQYSQTTDOGAKZZ9SCGIWTTOBPRWVPZRHZJHIWOKLZE9SQJWGPGFTX",
						CurrentIndex:             0x1,
						LastIndex:                0x2,
						Bundle:                   "FGEYEVYLIYESSZTIBXAIDQSK9QSJSX9JFLYKHETYIQRCWVRBVWIDQJBEUSHOIKRLJXLPSGWALTKFXSVCW",
						TrunkTransaction:         "VSAASONOCUUTNIVXUJ99ES9ZPPWVZOZBAIHL9ALHYDLYNFXSDYIOVUFHBZKVR9ETZDZHI9YHZZYO99999",
						BranchTransaction:        "CTHMUYWJYAICTJDPVKVIHDBLYDUKVVQPWKXAUW9FATKLSRUVSRTYAHYMTXYNJSZZSAOEXSXSYOLTZ9999",
						Nonce:                    "POWSRVIO9LVB999LNVMMGPTNNNV",
					},
					transaction.Transaction{
						Hash:                     "VSAASONOCUUTNIVXUJ99ES9ZPPWVZOZBAIHL9ALHYDLYNFXSDYIOVUFHBZKVR9ETZDZHI9YHZZYO99999",
						SignatureMessageFragment: "RDYUTFNZSKEHVWXFYVXUWYPBEUFULLNQRYYRHJRYNRMPGSIVRDPIAYIVKZNLECLRPVCOLPCVLTSGHCDSYUEYAV9QPLHO9VJ9AZQRNZQSJBNZCIMMBAAGB9YXKINSN9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
						Address:                  "PN9CYZTVHPKVRVBOOIRZDZSHQLURKQYSQTTDOGAKZZ9SCGIWTTOBPRWVPZRHZJHIWOKLZE9SQJWGPGFTX",
						CurrentIndex:             0x2,
						LastIndex:                0x2,
						Bundle:                   "FGEYEVYLIYESSZTIBXAIDQSK9QSJSX9JFLYKHETYIQRCWVRBVWIDQJBEUSHOIKRLJXLPSGWALTKFXSVCW",
						TrunkTransaction:         "CTHMUYWJYAICTJDPVKVIHDBLYDUKVVQPWKXAUW9FATKLSRUVSRTYAHYMTXYNJSZZSAOEXSXSYOLTZ9999",
						BranchTransaction:        "BZWSJSIGOCGELCBNELWXHQKNXZVHWSPFMIMI9CMBEZITWJNVNNCOWNSVQBFLIUILBQSUUCUIFGPW99999",
						Nonce:                    "POWSRVIO9LVB999UNTTPPPVNNNV",
					},
					transaction.Transaction{
						Hash:                     "FPZSZEPOSNZVCMDNIJVBNRJHMUXBKRIFEHBERVQCRJXJCIAXGEUHFJKKAZTCDBNWCFPZYUADQDPA99999",
						SignatureMessageFragment: "AZBCBCDTA9YWALKBOBQCBHBEOGVFTJGQGFVH9DDBETQCYZLHSBQQOEXKHVCRLBOTABTUYEJDNHXOBLWNITRDDKYCJOJVSLUDPBOYJ9WMLNDFWXKDAAJZDAIUUMLPVQMWIYJYE9G9BEIHBOQBKZZSLXBKGPDLPYRFLJPUTJOAJZELNGZFQBEPP9KNFNBQCQIBANQFLOQLQMFNMKDYJITRVLPDCWEBENYVT9GVPELRCMOHXPTCJMEEQLQGM9QG9WKHWJTBGXBVALITU9WIECZMQJLADX9WPIFB9QWLKBTEL9FTKLAQENDRESAZNSYGWCDMKO9GKVED9SXZKOJONWWIPKCTCCFBWYSCFAJPIQOCCCPLXZSNQJ9APQPYQMHQZBICSTJQIIHOSJKCZBFTMHEKPHOVYUXTBGOV99BRHKVFXOJO9QUCFKAUCZCSIFHNBRUNWSXOQAHOYHKHXLBRDSWHMPFEXLVEZWGLNAJOQSANSEJM9UOORSAWTNWIUPM9OJYMYHZDCF9LQYYYYCPQ9MAU9ABZPLLDTPISQBKIZMSOURGLKSQV9AXPFOBIPUNBQGZOMUGLJYBDXXWRJYOIXQTRVQYYOZAJ9YOFIVFBMRABSJFVNNMTMPYIEGNNPQEAPDXYYIIRNYVYUN9KAICLDLEDMGM9MKMAOMKNJTFJFXW9KRDELIPXMTSQFKHVMBP9VOS9SIFTCTHFQHNLAABDYOQDRUSI9MFUVTCWZB9CWRVZZQASQROBORXB9K9RXYOQNTPC9CNMHRISBQFSGNBGAOCYEHSVGV9PG99CUGFPTINEBWFUXUFICLWSVFGQVEJIUAWXGPXXXSTGQI9XHETTXFGYETDNUSVSAPNDOBVNWOG9AANDIIOKCWGF9NQYPMEWQPZGPHFIZQPV9BJGHSZGJFMXGJBMSVWFZYCSEYOPGCNJOZPSNHHYUVUMCHWYDJJDGNRJZXDTLWSHZVBVN9BLQKRAKKGQAYVPODVJDSUJRZHKKKPXVURBAACAUFUANUSCVFIYAUFDRHGHVNNBZVIVLJWNJTILTHGJM9UJSYBBZKOIBQXFRGEELNYLKGXWCUGXWL9XANUK9ARKCDRXXGTPN9OIUUSLJQJMYHMVVXMRMBXIAAZMRHZOPYOLLUAZCFRJSLRMXHPLGJCWOCPXRUIRXXHMKWQIQNZMANMAAJKDOLOLNKGESNAGKR9DCSJVWJWXKD9C9GHCKYRZWMPZUOBUCOAHAFINTREHCTZJCOVRDIBOFXMHHODGWSYBOQHQNG9PEOHUZXJRAKAOOSBNOJJAFFVNHLDKBVZIXNNINO9UDVMSEIROQBHYLLRKRMGAC9ORPOHABXJNXBHTIRMOPDLGSEBCNVEGCJIYZ9TFPHYAKICGBOMIHHWUAPFYMNBBRJNLSDWOVUBOIDJXXULJ99EHPYMLCDJI9NCORXTV9APH9YJSTOHUE9ENKFRKTSXT9ALCZNRYVHFYGSAHIKGURPCYPIUNGVRMDCUXXQXQOBRJRKQRQYMCDBCD9RXBFNBUARVRFTZLXZZXWWAFJKVBRGQDUUBDYUDSUXYOBPJMYTWYWPENKZOYMW9PALW9PCJZIXXUJ9RRVKDSPU9AGVPIZNWVYOECDOGZSTYCNRIGBKYVKRYFQJISNBNJOSEYED9HFPYJY9LTSIDYEUAVTUWFYGUHUNDPPVSPVZXPWUPHWRPULJYLODC9HXTZVJESQ9GQG9B9KTUYHIAGXVXOCZLUJBSKWTNYHGRAPTINBUINDHAVOINYETKGQ9OPMHZUQJFGWMPT9TWKHBMDJAWBWFIVSRBOLEZOYMLEDEDGWSKKIKNCYWFUVTFLUHEDHIOQVJVXXLQXETUSZJLUZA9BVTJTTMKSSXBPZLEAZ99XMRJBOHTMGUQSUXEFNKOKXBBNDMEUIBXG9ERVNSYFYFBGLJGIPPLQTVMVHBEMFNXLREVZEPHKKCAJNQ9AYPIXYUUUFACDEAJPHJYEQOBHUKCYTNLVVYQAKJBGH9UCSNALCEOGNBURFBTVFCNQHJ9GVBWQWMGPCQPEIKPSLLD9XXDC9XOZLPYINCYDJ9WPLBQADOI9GLAVGORRCPZDLTFKQLUDSRMFUHAXEVCVPBXQNWANKXDFKFRJ9GNIGATVAAMOFODQDBYMAKUXFOPZFAMXVAQXULGYLMTGHMONDZAXGAGYLSG",
						Address:                  "PN9CYZTVHPKVRVBOOIRZDZSHQLURKQYSQTTDOGAKZZ9SCGIWTTOBPRWVPZRHZJHIWOKLZE9SQJWGPGFTX",
						CurrentIndex:             0x0,
						LastIndex:                0x2,
						Bundle:                   "FGEYEVYLIYESSZTIBXAIDQSK9QSJSX9JFLYKHETYIQRCWVRBVWIDQJBEUSHOIKRLJXLPSGWALTKFXSVCW",
						TrunkTransaction:         "YJLLUHLGJNZNMT9JGIHNOTPUNHHZWSOC9NCUFYYUNX9VNVMSWIDYAFBYTBBCVMJUOLDZESRWTVZX99999",
						BranchTransaction:        "CTHMUYWJYAICTJDPVKVIHDBLYDUKVVQPWKXAUW9FATKLSRUVSRTYAHYMTXYNJSZZSAOEXSXSYOLTZ9999",
						Nonce:                    "POWSRVIO9LVB999OEKKKKVTNNNT",
					},
				}, nil
			}
			receiver := mam.NewReceiver(fakeAPI)

			err := receiver.SetMode(mam.ChannelModePrivate, "")
			Expect(err).NotTo(HaveOccurred())

			nextRoot, messages, err := receiver.Receive("PN9CYZTVHPKVRVBOOIRZDZSHQLURKQYSQTTDOGAKZZ9SCGIWTTOBPRWVPZRHZJHIWOKLZE9SQJWGPGFTXUMUPGBBN9")
			Expect(err).NotTo(HaveOccurred())
			Expect(messages).To(Equal([]string{"Hello!"}))
			Expect(nextRoot).To(Equal("HTGAUZTBH9SIVJVREIXLGAPPVQOFZZCRWDYSDG9JLXLFREYRWBEOBPSCSFTV9XZNIVZNAZINBAFDEWUZ9"))
		})

		It("Should receive a message from a restricted Channel", func() {
			fakeAPI := newFakeAPI()
			fakeAPI.findTransactionObjects = func(query api.FindTransactionsQuery) (transaction.Transactions, error) {
				Expect(query).To(Equal(api.FindTransactionsQuery{
					Addresses: trinary.Hashes{"UJSUOWHILOEKGAXCPUVTMNNVOLXSGIBFIVWVXTNRZF9AEIBOGTCGBXWGTNZJIXPALAQEFPAVNRYRLMOASZBZBPPVBW"},
				}))
				return transaction.Transactions{
					transaction.Transaction{
						Hash:                     "GJTUXOBGJBWYZVWMQSRHSFFRKRWAVHOFWJKTWDBWR9DXLTUUXXZWAJEOMNFBSERVVVQUZWHOCYNWZ9999",
						SignatureMessageFragment: "AZBCYUYKDKQHTDPALRTJWQQKAIPNKSDLWZTLOJPTHCHYXJAYPUMPPDUAKDDLWPXCLNQVGSCLSKZHHOCOWPLGXTNHUEABYXFPYLBSMYOLQHIUZCJRBMMFOGKBPOFNPDK9JUEDVJNMU9ZAFXFYBYLAULNEBHLZMCNKADKAVXJVTNALSWEQ9YSRIKBNFTWUIGWMEWZTDSIJA9MRJXZQOATEENEBNJDQFUBTWAZSVCZKJCANYOFG9HAMADCXQMNXIHVHVPOGXQEYIFDOODAQRKRCCGUOKEFIDBWCRVDBGUIEVBXRC9JRTSXUQUFNQOHLXETIZDNIOIHPGRKUEEGEMVTQZUDEMHVRTFVKIGCBNGSHJYPWVECQDKUWC9VYGGXYHHZGWVIC9CBDCNOY9XQQIEBJFYU9EGV9WETXTSPCSESDYLMPLLBBUN9IIXKSIUQIKJUAXQPDLELNNXOKKUVABIFJPVQKWFXT9HZBTBFL9CTWLKXCOVGEYFHMFPL9GRMFOEFOOWZCTRFZZDNDSSZDVNQBBDVFGHLBPGH9MRJCFPRQSMGDTHZTLLWWJVZINVLXBXUEEMVHNGQFTXFYYI9AWHUOFRKTGZOKNRRIGLKNLTDQRUCEFEVEEUPTYWXFFWDCBRCPPMPKMXYUXYPWOJGADUBAKHPCBYWVPHY9LOVQJZMVSFNIU9VSUUNTGBHHTLNRAQFDXITLKO9GLKXMMWQIJKBTFVNNMDSUSTUDXEONEXRFMQHMLDOFYEUYRXIVUU9NBXSGTCVCKSNXUJVUO9NOBSIHMNRGMDPQPIWXFJUAQS9KMOZGCGNCREBZWCQTPYHPJYWODKJJGYEIMXPDCQMPCLADQ9YLS9NGMZALPUXITZDYWSZPAPXCQDUYK9SGFORQ9VFSE9JJLKJPRGUVOIJUJLZIPO9ROSQKZIO9INF9VPSEFHFAPJBZSEVXLLAGGOYDR9BYWDM9GM9TJTMZYSRVWDVQFHEZH9RPTTZWZQBMMVSFORPRFCWHTWAVRTJESVJUOUETKUAX9VSOAMOK9AMYFQSAQLVIEIJFYOFPCVRCCJDJTKCJDJLNLMWLJVKDWQUJBFSQGFDLRRDJRMRGVUDPDUJM9WFAIBO9ZIGHYBBHLSQCPRGCYUHPALZBYKRHEHFMORGI99YKAMQINYSWWNXSTIWOBNYZVK9WHZKTXDIYB9BLJUHIIYTNQFIVEVUH9ZZFDWSHBBZV9TTIMDO9XPV9ORPORLXXOHSSHNVBWG9WJXMBSUWOEVDMVZLSJEDN9DENTHHMJACEURJCFOQNXKNXRJWQKOVNNGB9NDJUWUGQUQRLAWVYRIBMRUGQRGJLEADTJ9TVQOKWSTWSSRVPWTSAXLTDBECR9HLBEWJWYAKWSIWHLB9VYENQELP9UEFXZCLSLUSXSVYNJYOQRUNUAOHEKTFOYMELZRGOECGTIUXYNFBEIYKZSVBCFIOIJUABAOMSFJPASMYYGBVZOBZSRMWQJRQKFJPZZ9W9HY9PFEDHPLCXHLO9HXRLAAJXXZ9NHYZNVLPXTADCHRUHYNVHMTJBMNQMYYFYENYSMIOQZKPLSDNSOBXHLBAUXEUVENHZOTHTHWKWEHRDNKFWAXFVCVQKERQXLTSJTDHLMAXVYXCZTOWCKKSYESQYQZICDIQRACDBJEEKWEUQWSSHFHVGMNPUDLAAKHTZPLDMQR9KGOTGZUNOUPQICTYUNHORGAIWVLEXQ9XMMTDVGXUX9GTPAFOLOYIDCATZOPVXXXMXZQZUXUWEFMLJPHJKWENXTBFJXKDDWFMASWRSOXJBLDMVBWYX9MEDGMQVKQITFZOV9QKLMDVIKBYVLLVNDPOOWVOI9OEGOMLEIKRSSOIDLBLGLSFUIPTPFHVOCOXQKYNQJNQTDCQUBHIEBIPVDBZEXWBWYPOJWAVPUQY9GDBJ9LQCRWFWNQTQIYWHR9NBCXRZTPSC9XPGSIBNREANGLMUIYISAEFWU9WCIKKAEAYEBXIFZXYIAYZB9KZJEELWXNIYOKMHVWTMJGXJEATTZUXQXMAWGKJYOFSMHUFOEZNSKGKMIKYWXJTZBWHFBXLQBLJKBONLCFXEUWUWPWCHIY9MNBVNDGAUSHUXQKOT9POWOMLXUSMKPQYUALJMJBYHOXOFKPILWAREBIXURDPIKAQ9EHLZ9AYBGPWMXKZGXLBMCYZ",
						Address:                  "UJSUOWHILOEKGAXCPUVTMNNVOLXSGIBFIVWVXTNRZF9AEIBOGTCGBXWGTNZJIXPALAQEFPAVNRYRLMOAS",
						CurrentIndex:             0x0,
						LastIndex:                0x2,
						Bundle:                   "LSDLDKZKPXGGOJW9KFXF9OKFI9QWPBJWVJNKYDVBZFFJJFUWGBBYSEQ9JNJXFJYDHQLIOYQLJFPAJTTXC",
						TrunkTransaction:         "XMXNDJXZW9IPFRQTOTNJUMFXUD9GXFCNYPPNMNXAZSZWQNYIXBJOAXRGXBJIZVEXMKT9MGRS9JUXZ9999",
						BranchTransaction:        "ZWC9GOJWUGGEAWLHZWKOPAHVMIPI9BQTOAZJOJASBOAQE9EUDZZVOOKUBLNMJNGJAZUMASKGBJJP99999",
						Nonce:                    "POWSRVIO9LVB999ONGPPPMNNNNP",
					},
					transaction.Transaction{
						Hash:                     "XMXNDJXZW9IPFRQTOTNJUMFXUD9GXFCNYPPNMNXAZSZWQNYIXBJOAXRGXBJIZVEXMKT9MGRS9JUXZ9999",
						SignatureMessageFragment: "IXKPL9MYDOKZHSZLP9MLNXVT9INMCBLPJZAHJTUGOYYDCHHEQDZKBQTBMTDLJGAVREPUKFM9ENCTLCNX9ZCISAKGX99QUMF9NIDUFFQGXSBBQWXPFXORMNAERSTBAIBKDXLTFSDQCOAAJMTQGIMKABIULYMRYYDXMADCFYSZUAAPMEBEZMYIRSFXUNGTEPXTVABSBZFYY9XZCJTDQ9EUTPMCIKETIEWAJWSOQGRKHSBOGNDKXDLKECVIGUGXRTETHYVVTBJRQWTTFFCHLAXNIZHIGBTVHVUZAWKABVJZNGBNTWPZMKALNJKGRFUFSYANYUGMJXL9SJPRCXAKXGXEMFSPBLWXZXVCOPJPEUJMIEZD9YZVFQKKFZLFZUKEBXPJZABSUYBGWNLFEBVFNFLJ9YUASFWXMADKXYJSENKOKNXQEWLCHVWVJXZIGXKO9LJYZYJACQWADZNAZUQZRDNUZXSZNLPQIQRZFZFY9JVLEVCVDQWQOFYLSG9HZMGCQPVR9VI9QHNSOTMGKAV9QYOGGDWCMINCKYGG9JVNLKXPXPJIEYBHTTAJCRYWSPAFSLPSKGV9IOEXQRADGZWJVIMWPJQKFQPSDECNLGYJJFFWFZFJWAUWWZGIUYHSJCKPGRBOQLKAUNASYZIF9QEQZPNWMDBZEZLZTS9LNYXVGIQKKQUXYETLOPTZWVKQXBYBTWVXFRGDLSINOOSPOMPLNMAXQLYHMZBLXLBSQRNUUSVWPJTQ9JUXHOFSPTEX9XQZMQTTKYKFMNVZYKPZ9KIVEAOVGDVVMKNPSNKYJCXSJN9JMKTGTTNNUICRUEIHQBXKSACNRFORSGPCJQKPXOXDHDWMINLLRDEWWPWIVZEN9ZVMLSCFXSMIBGMYSLHC9KZJQOYJDLDYDTEXQWJRPR9IFI9G9ANSGLZY9YSDLZJTTNIWMERV9VAW9LJZCJTJRBSQPHBULXMNOPMPVFCNCLPQGJLBBMDVECGGMJCSUAHBMJACVYBVISQEMLC9QFVZIQYU9LRQQSWVJCTXLNICAWEZQGLPBKBDWUZVZBBTJUPIZDIOGYBROTOJWNJLUAXAYADVTCLXGIKGCLOSSK9OUSEWYXGSXGORYOTPZGCNXHY9KHMFMKNXMVVUIPNRFKKKBYUHYYIPNBNLI9IOZKXUCHWSNTAMZLXZZWFNPMBZMKBVJZHVXGR9RRAUNNIHEWUJLZOWKMAOLI9SZSQLVERVADQZ9RMXI9AZKDDCDHO9ZTNAPQ9ODNAOODCFZKVZNIPDR9NECA9WBAWPEVDCNRTHUSWAZMUZXZDXCDDPUXEEEJCPUZEJUGRTPCI9IRUETPANTFEPRQNGSSOGWEALPLKDUJN9MANIEMGYCYXEZTDPNLBH9UFQTETUHQYBDKDNWLEVHORRGBPPSUYKNJJP9FTFWUFOWCSV9JTFBVRQ9VVBRNVQRFAYPSKXMPCDSXBCHZC9PAUEKVYDWGMYYYUIANUTDUKCBQZFM9CSGTBZVKX9INKRQKUELMIXPLTIXZKCGVZLPQ9CHWVYWA9NUEFBRDQJGBPV9AQ9DBWWHWFGOZEIZDNHRBJORFFMDZIBSXDUYIRLMLIHAFBMEWXSKVQRYENNWCBFKGETVUFHTKSKOFVYVFUTZBKAWKJAOUMPNRZPLRUGADPRWNJVHOEEPQ9BYBGEC9OVNHQPLFEWNRLXTFKHIGUXVIGJ9RKJBK9ETLWFN9LGLWBYQVGI9WANBUVIUSNYTWTDCUFZEGPSDALQWOTXSDYRMCYWXWDHXIZOWVBIJNXZWAFBIKHPZITSMVOBCLTBXBYESUKPEYKVWKIZPDSJAQMBZAYLNZQWYVC99ADTTCXYRLXCQRQDONYGRZUOJIDDWLNJOTCNHULNCGUNJJLZOFZPMAYXPONVCFIUPJETYWQPCUNGXHATMLYQMEIWVZLCWWFTTIHPBGBVUJWJAALZOMSANDUUXQDESR9DDVLGVDAEMPBCGLQXMXDMDHYOERBPACDMMQVPENMDMWYJJHWZRNGGISFVLNFDURHTZZTEQEIBOLIRFCYGSYMZJNOARGWCTRJUUIJESKA9GXUXNCWVMFWVYABIKPFUNOWIJZGOKVWRMPABGQGMMGJRMKMCDPJJFNYKREUDPQHPRVLQEVBGHMBR9RPDMFINHNFBNWNPKUJRLGEHALIFAFANJORUDGZ",
						Address:                  "UJSUOWHILOEKGAXCPUVTMNNVOLXSGIBFIVWVXTNRZF9AEIBOGTCGBXWGTNZJIXPALAQEFPAVNRYRLMOAS",
						CurrentIndex:             0x1,
						LastIndex:                0x2,
						Bundle:                   "LSDLDKZKPXGGOJW9KFXF9OKFI9QWPBJWVJNKYDVBZFFJJFUWGBBYSEQ9JNJXFJYDHQLIOYQLJFPAJTTXC",
						TrunkTransaction:         "NEBGYCXYRRENUW9KHA9NVBFISFBXGNACSINPPRBODKHQLHA9EKTDGHUIASJBFFBYLDBSSREOAYWUZ9999",
						BranchTransaction:        "ZWC9GOJWUGGEAWLHZWKOPAHVMIPI9BQTOAZJOJASBOAQE9EUDZZVOOKUBLNMJNGJAZUMASKGBJJP99999",
						Nonce:                    "POWSRVIO9LVB999FMVPPMVNNNNP",
					},
					transaction.Transaction{
						Hash:                     "NEBGYCXYRRENUW9KHA9NVBFISFBXGNACSINPPRBODKHQLHA9EKTDGHUIASJBFFBYLDBSSREOAYWUZ9999",
						SignatureMessageFragment: "9QOJCZIKQ9IMMKBSWTJ9AVBABAPQHQZIVXPTDKGODOQXXQEHMBOMRCVUZGUTOPXKRKGDLERPPQHBSYCI9XWM9ESGBQYZUZJK9KIZDCOELQHVHRHLHOB9PVSRWCGPUZ999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999",
						Address:                  "UJSUOWHILOEKGAXCPUVTMNNVOLXSGIBFIVWVXTNRZF9AEIBOGTCGBXWGTNZJIXPALAQEFPAVNRYRLMOAS",
						CurrentIndex:             0x2,
						LastIndex:                0x2,
						Bundle:                   "LSDLDKZKPXGGOJW9KFXF9OKFI9QWPBJWVJNKYDVBZFFJJFUWGBBYSEQ9JNJXFJYDHQLIOYQLJFPAJTTXC",
						TrunkTransaction:         "ZWC9GOJWUGGEAWLHZWKOPAHVMIPI9BQTOAZJOJASBOAQE9EUDZZVOOKUBLNMJNGJAZUMASKGBJJP99999",
						BranchTransaction:        "OFVXJEDJFKSUVKEHTIHBLSCCLRHTMJGTAQTUMHPFSRLHNOXWEEFFHRLCIRJGSBMMA9XAWKIAERFQ99999",
						Nonce:                    "POWSRVIO9LVB999UNMMMEPNNNNP",
					},
				}, nil
			}
			receiver := mam.NewReceiver(fakeAPI)

			err := receiver.SetMode(mam.ChannelModeRestricted, "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA")
			Expect(err).NotTo(HaveOccurred())

			nextRoot, messages, err := receiver.Receive("FBVSGGJWUJFVTQCASKBVO9PJAHYZMHU9SVQUGJJLET9UQE9YT9PLOJWENULIVYMOLYSNEM9UUXFCAJKVJ")
			Expect(err).NotTo(HaveOccurred())
			Expect(messages).To(Equal([]string{"Hello!"}))
			Expect(nextRoot).To(Equal("RKIBPEBXNLLXSXCWBDXSKYZEIJZPQUSXSQSDAUPDDSFS9W9BOPGSMKRJINQ9CGFKSUBMTKXDY9RMGJQE9"))
		})

	})

})
